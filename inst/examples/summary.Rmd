---
title: "Summary"
author: "Niko Ilom√§ki"
date: "Tuesday, March 3, 2015"
output: pdf_document
---

# Summary of the preprocessed Fennica data

## Annotated documents

Fraction of documents with entries for each annotation field.

```{r, annotations, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=10, fig.height=15}

library(stringr)

load(file="../../dfs.RData")

df <- df.summary

library(dplyr)
library(ggplot2)
missing <- 100*apply(df, 2, function (x) {mean(is.na(x))})
df3 <- data.frame(list(missing = missing, field = names(missing)))
df3$field <- factor(df3$field, levels = df3$field[rev(order(df3$missing))])
theme_set(theme_bw(15))
p <- ggplot(df3, aes(x = field, y = 100 - missing))
p <- p + geom_bar(stat = "identity")
p <- p + coord_flip()
p <- p + ylab("")
p <- p + xlab("")
p <- p + ggtitle("Documents with data (%)")
print(p)
```

## Topics

```{r, topics, echo=FALSE, message=FALSE, warning=FALSE}

load(file="../../dff.RData")

df <- df.full

# List all topics
spl <- strsplit(na.omit(as.character(df$term_tpc)), ";")

# Topics per document
# hist(sapply(spl, length))

# Documents per topic
tab <- sort(table(unlist(spl)))
tab <- tab[!names(tab) == "NA"]
tab <- rev(sort(tab)) 
```

```{r, topics2, echo=FALSE, message=FALSE, warning=FALSE}
# Write to file
f <- "output.tables/subjecttopics.tab"
print(paste("Complete subject topic counts in file:", f))
write.table(cbind(Topic = sort(names(tab))), file = f, sep = "\t", quote = F, row.names = F)
ntop <- 50
```

Top-`r ntop` topics and number of documents for each. In total, there are `r length(unique(df$term_tpc))` unique topics and `r sum(!is.na(df$term_tpc))` documents assigned to one or more topics (`r round(100*mean(!is.na(df$term_tpc)))`).

```{r, topics22, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10}
par(mar = c(5, 10, 3, 1)); barplot(rev(rev(sort(table(df$term_tpc)))[1:ntop]), horiz = T, las = 1, cex.names = 0.8, xlab = "Documents", main = "Most common topics")
```


## Authors

Top-`r ntop` uniquely identified authors and number of documents for each (duplicate docs not checked yet).

```{r, authors, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10}
ntop <- 50
a <- rev(rev(sort(table(df$author_nam)))[1:ntop])
par(mar = c(5, 10, 3, 1)); barplot(a, horiz = T, las = 1, cex.names = 0.8, xlab = "Documents", main = "Top authors")
```


## Subject geographical places

```{r, geo, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10}
tab <- rev(sort(table(unlist(strsplit(as.character(df$term_geo), ";")))))
```

Top-`r ntop` geographical places are shown together with the number of documents assigned to that region. Geography information is available for `r sum(!is.na(df$term_geo))` documents (`r round(100*mean(!is.na(df$term_geo)))`%). There are `r length(tab)` unique geographical places.

```{r, geo2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10}
ntop <- 50
par(mar = c(5, 10, 3, 1)); barplot(log10(rev(tab[1:ntop])), horiz = T, las = 1, cex.names = 0.8, xlab = "Documents (log10)", main = "Most common geographic places")
```

```{r, geo3, echo=FALSE, message=FALSE, warning=FALSE}
f <- "output.tables/geoplaces.csv"
print(paste("Complete counts in file:", f))
write.table(cbind(Geography = names(tab), Documents = tab), file = f, sep = "|", quote = F, row.names = F)
```



## Publication 

### Publication places

Top-`r ntop` publication places are shown together with the number of documents. This info is available for `r sum(!is.na(df$publication_plc))` documents (`r round(100*mean(!is.na(df$publication_plc)))`%). There are `r length(unique(str_trim(unlist(strsplit(as.character(df$publication_plc), ";")))))` unique publication places.

```{r, place, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10}
tab <- rev(sort(table(str_trim(unlist(strsplit(as.character(df$publication_plc), ";"))))))
ntop <- 50
par(mar = c(5, 10, 3, 1)); barplot(log10(rev(tab[1:ntop])), horiz = T, las = 1, cex.names = 0.8, xlab = "Documents (log10)", main = "Most common publication places")
```

```{r, place2, echo=FALSE, message=FALSE, warning=FALSE}
f <- "output.tables/publicationplaces.csv"
print(paste("Complete counts in file:", f))
write.table(cbind(Place = names(tab), Documents = tab), file = f, sep = "|", quote = F, row.names = F)
```

