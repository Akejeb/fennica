--- 
title: "Harmonized Finnish National Bibliography"
author: "Turku Data Science Group"
date: "`r Sys.Date()`"
site: "bookdown::bookdown_site"
output:
  output: bookdown::gitbook
github-repo: fennicahub/fennica
url: https://github.com/fennicahub/fennica
  
documentclass: book
---

# Preface chapter

As part of the Metadata Harmonization And Analysis work package, we use the Finnish national bibliography (FNB) Fennica dataset to create a harmonized dataset that can be used for research purposes as well as provide the groundwork for infrastructure that can be iterated further. 

The FNB contains metadata for 71,919 documents and spans over 450 years, more specifically consisting of records printed between 1488 and 1955. There are 28 data fields in raw data in machine-readable cataloguing (MARC) format, which provide information on the document, for example, language, author name, author lifetime, publication title, publication place, publisher, and page count. Through harmonization and enriching the dataset with data from other sources, the abovementioned 28 fields can result in 96 data fields per document. (Tolonen, et al 2019.)

An important output of our work is a harmonized version of the FNB. The FNB metadata is an example of a dataset consisting of structured data. The FNB dataset is not created for research purposes and needs refining before it can be used. Tools are needed for accessing, cleaning, refining, enriching and analysing this type of data, and printing documentation of this process.

In this bookdown project we will disseminate the FNB dataset cleaning process.


```{r source-index, include=FALSE}
source("init.R")
# knit_bookdown <- TRUE in init.R
```

This document was generated with the following packages:

```{r system-information}
sessionInfo()
```

<!--chapter:end:index.Rmd-->

# Author's lifetime

```{r source-author-date, include=FALSE}
# author_date field
source("author_date.R")
```

[Author date accepted](output.tables/author_date_accepted.csv)

[Author date discarded](output.tables/author_date_discarded.csv)

Author's lifetime is available for `r sum(!is.na(df$author_age))` authors (`r round(100*mean(!is.na(df$author_age)))`%).The lifetime years span `r range(na.omit((df$author_age)))`. The youngest being 17 years old and the oldest 99 years old.





<!--chapter:end:author_date.Rmd-->

# Author's name

```{r setup-author-name, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-author-name, include=FALSE}
# author_name field
source("author_name.R")
```

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)
 
 Top-`r ntop` titles and their title counts.
 
```{r summarytitle-author-name, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "author_name", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique titles:
  
```{r uniquetitles-author-name, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$author_name)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```


## Authors

* `r length(unique(df$author_name))` [unique authors](output.tables/author_accepted.csv) These final names capture all name variants from the custom [author synonyme table](output.tables/ambiguous-authors.csv), and exclude known pseudonymes (see below). If multiple names for the same author are still observed on this list, they should be added on the [author synonyme table](output.tables/ambiguous-authors.csv).
 * `r sum(!is.na(df$author_name))` documents have unambiguous author information (`r round(100*mean(!is.na(df$author_name)))`%). 
 * `r length(readLines(paste0(getwd(),"/output.tables/pseudonyme_accepted.csv")))-2` [unique pseudonymes](output.tables/pseudonyme_accepted.csv) are recognized based on [custom pseudonyme lists](output.tables/custom_pseudonymes.csv).
 * `r length(readLines(paste0(getwd(),"/output.tables/author_discarded.csv")))-2` [discarded author names](output.tables/author_discarded.csv) This list should not include any real authors (if it does, please send a note to the admin). The stopword lists are considered when discarding names.
 * [Author name conversions](output.tables/author_conversion_nontrivial.csv) Non-trivial conversions from the original raw data to final names.
 
### Auxiliary files

 * [Author synonyme table](output.tables/ambiguous-authors.csv)
 * [Stopwords for names](output.tables/stopwords_for_names.csv)
 * [Stopwords for titles](output.tables/stopwords_titles.csv)
 * [Custom pseudonyme lists](output.tables/custom_pseudonymes.csv)
 
Top-`r ntop` uniquely identified authors and their productivity (title count).

```{r summaryauthorsnames, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=8}
knitr::opts_chunk$set(fig.path = "figure/", dev="CairoPNG")
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- NULL
p <- top_plot(df, "author_name", ntop) +
     		  ggtitle(paste("Top authors' names")) +
		  ylab("Documents")
print(p)
```


### Author productivity

Title count in relation to the paper consumed in their books(all authors):

```{r authortitlespapers, fig.height=8, fig.width=18, echo=FALSE, warning=FALSE}
library(dplyr)
library(gridExtra)
library(grid)
library(ggplot2)
library(lattice)

theme_set(theme_bw(base_size = 12))
res1 <- compare_title_paper(df, "author_name", plot.mode = "text")
res2 <- compare_title_paper(df, "author_name", plot.mode = "point")
grid.arrange(res2$plot, res1$plot, nrow = 1)
#kable(res1$table)
```



<!--chapter:end:author_name.Rmd-->

# Corporate

```{r setup-corporate, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-corporate, include=FALSE}
# corporate field
source("corporate.R")
```
Corporate-field contains names of the printing houses ("kirjapaino" in Finnish), manufactures, companies or institutions involved in printing of the books.

[Accepted corporate info](output.tables/corporate_accepted.csv)

[Discarded corporate info](output.tables/corporate_discarded.csv)

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)


 Top-`r ntop` titles and their title counts.
 
```{r summarytitle-corporate, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "corporate", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique titles:
  
```{r uniquetitles-corporate, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$corporate)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```





<!--chapter:end:corporate.Rmd-->

```{r source-language, include=FALSE, eval=knit_bookdown}
# Language
source("language.R")
```

# Language summaries

 * `r length(unique(unlist(strsplit(as.character(df$languages), ";"))))-1` [unique languages](output.tables/languages_accepted.csv)
 * `r length(unique(df$language_primary))-1` [unique primary languages](output.tables/language_primary_accepted.csv)  
 * `r sum(!df$multilingual, na.rm = TRUE)` single-language documents (`r round(100 * mean(!df$multilingual, na.omit = TRUE), 2)`%)
 * `r sum(df$multilingual, na.rm = TRUE)` multilingual documents (`r round(100 * mean(df$multilingual, na.omit = TRUE), 2)`%) 
 * [Conversions from raw to preprocessed language entries](output.tables/language_conversions.csv) 
 * `r sum(is.na(df$languages) | df$language_primary == "Undetermined")` documents (`r round(100*mean(is.na(df$languages) | df$language_primary == "Undetermined"), 2)`%) with [unrecognized language](output.tables/language_discarded.csv)

Language codes are from [MARC](http://www.loc.gov/marc/languages/language_code.html); new custom abbreviations can be added in [this table](output.tables/language_abbreviations.csv).



## Top languages

Number of titles assigned with each language (top-10). For a complete list,
see [accepted languages](output.tables/language_accepted.csv).

```{r summarylang2, echo=FALSE, results='asis'}
x <- top(df, "languages")
tab <- cbind(names(x), unname(x), round(100 * unname(x/nrow(df)), 1))
colnames(tab) <- c("Language", "Documents (n)", "Fraction (%)")
kable(head(tab, 10))
```

Title count per language (including multi-language documents; note the log10 scale):

```{r summarylang, echo=FALSE, message=FALSE, warning=FALSE, fig.width=7, fig.height=5}
top_plot(df, "languages", ntop = ntop, log10 = TRUE) + labs(y = "Entries (n)")
```

<!--chapter:end:language.Rmd-->

# Holder


```{r setup-holder, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-holder, include=FALSE, eval=knit_bookdown}
# holder field
source("holder.R")
```

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)


 Top-`r ntop` titles and their title counts.
 
```{r summarytitle-holder, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "holder", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique titles:
  
```{r uniquetitles-holder, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$holder)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```

<!--chapter:end:holder.Rmd-->

```{r setup-note-dissertation, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-note-dissertation, include=FALSE, eval=knit_bookdown}
# note_dissertation field
source("note_dissertation.R")
```

# Note dissertation

The amount and types of academic dissertations or thesis are presented. Two types of thesis exists in Fennica: "Diss"/"Diss:Diss" and "Diss synod"; with the former being a majority among the two types. 

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)
 
 Top-`r ntop` titles and their title counts.
 
```{r summarytitle-note-dissertation, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "note_dissertation", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique titles:
  
```{r uniquetitles-note-dissertation, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$note_dissertation)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```

<!--chapter:end:note_dissertation.Rmd-->

```{r setup-note-granter, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-note-granter, include=FALSE, eval=knit_bookdown}
# note_granter field
source("note_granter.R")
```

# Note granter

The field summons names of the dissertations granting educational institutions and the amount of thesis granted by each university. Some universities are mentioned more than once due to the differences in the language the book was written in, for example, "Helsinki yliopisto" in Finnish and "Helsingfors universitet" in Swedish or "Upsala" in old Finnish and "Uppsala" in Swedish. 

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)

 
 Top-`r ntop` titles and their title counts.
 
```{r summarytitle-note-granter, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "note_granter", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique titles:
  
```{r uniquetitles-note-granter, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$note_granter)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```

 

<!--chapter:end:note_granter.Rmd-->

```{r setup-note-source, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-note-source, include=FALSE, eval=knit_bookdown}
# note_source field
source("note_source.R")
```

# Note source

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)
 
 Top-`r ntop` titles and their title counts.
 
```{r summarytitle-note-source, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "note_source", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique titles:
  
```{r uniquetitles-note-source, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$note_source)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```

 

<!--chapter:end:note_source.Rmd-->

```{r source-publisher, include=FALSE, eval=knit_bookdown}
# publisher field
source("publisher.R")
```

# Publisher preprocessing summary

 * `r length(unique(df$publisher))` [unique publishers](output.tables/publisher_accepted.csv)

 * `r sum(!is.na(df$publisher))` documents have unambiguous publisher information (`r round(100*mean(!is.na(df$publisher)), 1)`%). This includes documents identified as self-published; the author name is used as the publisher in those cases (if known).


 * [Discarded publisher entries](output.tables/publisher_discarded.csv)

 * [Conversions from original to final names](output.tables/publisher_conversion_nontrivial.csv) (only non-trivial conversions shown)


The `r ntop` most common publishers are shown with the number of documents. 

```{r summarypublisher2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=9}
p <- top_plot(df, "publisher", ntop)
p <- p + ggtitle(paste("Top publishers"))
p <- p + scale_y_log10()
p <- p + ylab("Documents")
print(p)
```



Title count versus paper consumption (top publishers):

```{r publishertitlespapers, fig.height=8, fig.width=8, echo=FALSE, warning=FALSE}
#res <- compare_title_paper(df, "publisher", selected = tops)
tops <- names(top(df, field = "publisher", n = 10))
res <- compare_title_paper(df, "publisher")
print(res$plot)  
kable(subset(res$table, publisher %in% tops), digit = 2)
```









<!--chapter:end:publisher.Rmd-->

```{r source-publication-interval, include=FALSE, eval=knit_bookdown}
#publication_interval field
source("publication_interval.R")
```

# Publication interval summaries

Publication interval is available for `r sum(!is.na(df$publication_interval_from) | !is.na(df$publication_interval_till))` documents (`r round(100*mean(!is.na(df$publication_interval_from) | !is.na(df$publication_interval_till)))`%). 

[Publication interval accepted](output.tables/publication_interval_accepted.csv)

[Publication interval conversions](output.tables/publication_interval_conversion_nontrivial.csv)

[Publication interval discarded](output.tables/publication_interval_discarded.csv)



<!--chapter:end:publication_interval.Rmd-->

```{r source-publication-place, include=FALSE, eval=knit_bookdown}
# Publication place field and derived country- and geoinformation
source("publication_place.R")
```

# Publication place preprocessing summary

 * `r length(unique(str_trim(unlist(strsplit(as.character(df$publication_place), ";")))))` [unique publication places](output.tables/publication_place_accepted.csv); available for `r sum(!is.na(df$publication_place))` documents (`r round(100*mean(!is.na(df$publication_place)))`%).
 * `r length(readLines(paste0("output.tables/publication_place_ambiguous.csv"))) - 1` [ambiguous publication places](output.tables/publication_place_ambiguous.csv); some of these can be possibly resolved by checking that the the [synonyme list](output.tables/PublicationPlaceSynonymes.csv) does not contain multiple versions of the final name (case sensitive). 
 * `r try(length(readLines(paste0("output.tables/publication_place_todo.csv"))))` [unknown place names](output.tables/publication_place_todo.csv) These terms do not map to any known place on the [synonyme list](output.tables/PublicationPlaceSynonymes.csv); either because they require further cleaning or have not yet been encountered in the analyses. Terms that are clearly not place names can be added to [stopwords](output.tables/stopwords_for_place.csv); borderline cases that are not accepted as place names can be added as NA on the [synonyme list](output.tables/PublicationPlaceSynonymes.csv).
 * `r length(readLines(paste0("output.tables/publication_place_discarded.csv"))) - 1` [discarded place names](output.tables/publication_place_discarded.csv) These terms are potential place names but with a closer check have been explicitly rejected on the [synonyme list](output.tables/PublicationPlaceSynonymes.csv)
 * [Conversions from the original to the accepted place names](output.tables/publication_place_conversion_nontrivial.csv) 
<!-- * [Unit tests for place names](https://github.com/COMHIS/fennica/blob/master/inst/extdata/tests_place.csv) are automatically checked during package build -->

Top-`r ntop` publication places are shown together with the number of documents.

```{r summaryplace, echo=FALSE, message=FALSE, warning=FALSE, error= FALSE, fig.width=9, fig.height=6}
p <- top_plot(df, "publication_place", ntop)
p <- p + ggtitle(paste("Top publication places"))
p <- p + scale_y_log10()
p <- p + ylab("Title count")
print(p)

p <- top_plot(df, "publication_country", ntop)
p <- p + ggtitle(paste("Top publication countries"))
p <- p + scale_y_log10()
p <- p + ylab("Title count")
print(p)
```


## Publication countries	

 * `r length(unique(df$publication_country))` [unique publication countries](output.tables/publication_country_accepted.csv); available for `r sum(!is.na(df$publication_country))` documents (`r round(100*mean(!is.na(df$publication_country)))`%).
 * `r length(na.omit(unique(subset(df, is.na(publication_country))$publication_place)))` [places with unknown publication country](output.tables/publication_place_missingcountry.csv) (`r round(100 * length(na.omit(unique(subset(df, is.na(publication_country))$publication_place))) / length(na.omit(unique(df$publication_place))), 1)`% of the unique places; can be added to [country mappings](output.tables/reg2country.csv))
 * `r length(readLines(paste0("output.tables/publication_country_ambiguous.csv"))) - 1` [potentially ambiguous region-country mappings](output.tables/publication_country_ambiguous.csv) (these may occur in the data in various synonymes and the country is not always clear when multiple countries have a similar place name; the default country is listed first). NOTE: possible improvements should not be done in this output summary but instead in the [country mapping file](output.tables/reg2country.csv).

```{r summaryplace3, echo=FALSE, results='asis'}
tab <- top(df, "publication_country", output = "data.frame", round = 1)
colnames(tab) <- c("Country", "Documents (n)", "Fraction (%)")
library(knitr)
kable(head(tab))
```


## Geocoordinates

 * `r round(100*mean(!is.na(df$latitude) & !is.na(df$longitude)), 1)`% of the documents were matched to geographic coordinates (based on COMHIS geomapping process).
 * `r length(unique(df$publication_place[(is.na(df$latitude))]))` unique places (`r round(100 * length(unique(df$publication_place[(is.na(df$latitude))]))/length(unique(df$publication_place)), 1)`% of all unique places and `r round(100 * mean(is.na(df$latitude) | is.na(df$longitude)), 2)`% of all documents) are missing geocoordinates. See [list of places missing geocoordinate information](output.tables/absentgeocoordinates.csv).
 


<!--chapter:end:publication_place.Rmd-->

```{r source-publication-time, include=FALSE, eval=knit_bookdown}
# Publication place field and derived country- and geoinformation
source("publication_time.R")
```

# Publication year summaries (publication time)

[Publication year conversions](output.tables/publication_time_conversion.csv)

[Publication year discarded](output.tables/publication_time_discarded.csv)

Publication year is available for `r sum(!is.na(df$publication_year))` documents (`r round(100*mean(!is.na(df$publication_year)))`%). The publication years span `r paste(range(na.omit(df$publication_year)), collapse = "-")`.

```{r summarypublicationyear, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
# Title count per decade
df2 <- df %>% group_by(publication_decade) %>% filter(publication_decade < 2010) 
p <- ggplot(df2, aes(publication_decade)) +
     geom_bar() + scale_y_log10() +
     ggtitle("Title count timeline")
print(p)
```



<!--chapter:end:publication_time.Rmd-->

```{r setup-subject-topic, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-subject-topic, include=FALSE, eval=knit_bookdown}
# note_subject_topic field
source("subject_topic.R")
```

# Subject topic

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)


 Top-`r ntop` titles and their title counts.
 
```{r summarytitle-subject-topic, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "subject_topic", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique titles:
  
```{r uniquetitles-subject-topic, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$subject_topic)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```

<!--chapter:end:subject_topic.Rmd-->

```{r source-subject-geography, include=FALSE, eval=knit_bookdown}
# note_subject_topic field
source("subject_geography.R")
```

# Subject geography preprocessing summary (Subject geographical places)

```{r geo, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10}
tab <- rev(sort(table(unlist(strsplit(as.character(df$subject_geography), ";")))))
```

Top-`r ntop` geographical places are shown together with the number of documents assigned to that region. Geography information is available for `r sum(!is.na(df$subject_geography))` documents (`r round(100*mean(!is.na(df$subject_geography)))`%). There are `r length(tab)` unique geographical places.

```{r geo2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10, eval=FALSE}
ntop <- 50
par(mar = c(5, 10, 3, 1)); barplot(log10(rev(tab[1:ntop])), horiz = T, las = 1, cex.names = 0.8, xlab = "Documents (log10)", main = "Most common geographic places")
```

```{r geo3, echo=FALSE, message=FALSE, warning=FALSE}
f <- "output.tables/geoplaces.csv"
write.table(cbind(Geography = names(tab), Documents = tab), file = f, sep = "|", quote = F, row.names = F)
```

[Complete geoplace listing](output.tables/geoplaces.csv)



<!--chapter:end:subject_geography.Rmd-->

```{r setup-successor, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-successor, include=FALSE, eval=knit_bookdown}
# successor field
source("successor.R")
```

# Successor

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)


Top-`r ntop` titles and their title counts.
 
```{r summarytitle-successor, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, field, ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique entries:
  
```{r uniquetitles-successor, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df[[field]])
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```

<!--chapter:end:successor.Rmd-->

```{r setup-title, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-title, include=FALSE, eval=knit_bookdown}
# Title fields
source("title.R")
```

# Title field: summary

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)


Top-`r ntop` titles and their title counts.

```{r summarytitle-title, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "title", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
```



Frequency of unique titles:

```{r uniquetitles-title, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$title)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
       geom_histogram(color="black", fill="white") +
       scale_x_log10() +
       scale_y_log10() +
       labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```





<!--chapter:end:title.Rmd-->

```{r setup-title-uniform, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-title-uniform, include=FALSE, eval=knit_bookdown}
# Title fields
source("title_uniform.R")
```

# Title uniform

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)


Top-`r ntop` titles and their title counts.

```{r summarytitle-title-uniform, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "title_uniform", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
```


Frequency of unique titles:
  
```{r uniquetitles-title-uniform, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$title)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```

<!--chapter:end:title_uniform.Rmd-->

```{r setup-uncontrolled, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path=paste0("figure/rmd_", field, "_"))
```

```{r source-uncontrolled, include=FALSE, eval=knit_bookdown}
# uncontrolled field
source("uncontrolled.R")
```

# Uncontrolled

* [Unique accepted entries](`r file_accepted`): `r length(unique(df[[field]]))`
* [Unique discarded entries in original data](`r file_discarded`) (excluding NA cases): `r as.vector(countLines(file_discarded) - 1)`
* Original documents with non-NA titles: `r sum(!is.na(df[[field]]))` / `r nrow(df)` (`r round(100*mean(!is.na(df[[field]])), 1)`%)
* Original documents with missing (NA) titles `r sum(is.na(df[[field]]))` / `r nrow(df)` documents (`r round(100*mean(is.na(df[[field]])), 1)`%)



 Top-`r ntop` titles and their title counts.
 
```{r summarytitle-uncontrolled, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- top_plot(df, "uncontrolled", ntop = ntop, log10 = TRUE)+
  labs(y = "Entries (n)", title = "Top titles")
print(p)
``` 

Frequency of unique titles:
  
```{r uniquetitles-uncontrolled, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
tab <- table(df$uncontrolled)
d <- data.frame(title = names(tab), n = as.numeric(tab))

library(ggplot2)
theme_set(theme_bw(base_size = 12))
p <- ggplot(d, aes(x = n)) +
  geom_histogram(color="black", fill="white") +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Title duplicates (n)", y = "Documents (n)")
print(p)
```

<!--chapter:end:uncontrolled.Rmd-->

