---
title: "Digital History in Finland, 1488-1828"
author: "Mikko Tolonen, Jani Marjanen, Hege Roivainen, Leo Lahti"
date: "`r Sys.Date()`"
bibliography: 
- bibliography.bib
- references.bib
output: 
  md_document:
    variant: markdown_github
---
<!--
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{microbiome tutorial}
  %\usepackage[utf8]{inputenc}
-->

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Handle citations
require(knitcitations)
cleanbib()
#options("citation_format" = "pandoc")
cite_options(hyperlink = TRUE, max.names = 3)
bib <- read.bibtex("bibliography.bib")
#opts_chunk$set(fig.width=4, fig.height=3, par=TRUE, out.width='2in', fig.pos='H')
knitr::opts_chunk$set(fig.path = "figure_201606_Krakow/", dev="CairoPNG")
#knitr::opts_chunk$set(fig.path = "figure_201606_Krakow/")
```

```{r 201606krakow-init, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
library(stringr)
library(dplyr)
library(ggplot2)
library(bibliographica)
library(fennica)
library(sorvi)

# Nice theme
theme_set(theme_bw(26))

# Define time span
min.year = 1470
max.year = 1828

# Read data
fen <- readRDS("df.Rds")
kun <- readRDS("../../../kungliga/antagomir/df.Rds")

fenraw <- readRDS("df.raw.Rds")
kunraw <- readRDS("../../../kungliga/antagomir/df.raw.Rds")

fen <- fen %>% filter(publication_year >= min.year & publication_year <= max.year)
kun <- kun %>% filter(publication_year >= min.year & publication_year <= max.year)
df0 = bind_rows(fen, kun)
df0$catalog = factor(c(rep("Fennica", nrow(fen)), rep("Kungliga", nrow(kun))))
```



Printing in a Periphery: a Quantitative Study of Finnish Knowledge Production, 1640-1828
==============

## Introduction 



Matti Klinge HYn historia; Jari Niemelä, Vain hyödynkö tähden
(väitöskirja) käsittelee Turun yliopiston asemaa.

Östholm, Hanna, Litteraturens uppodling : läsesällskap och litteraturkritik som politisk strategi vid sekelskiftet 1800; vertailee Turkua ja Uppsalaa lukuseurojen kautta. 

Grönroos, Henrik & Nyman, Ann-Charlotte, Boken i Finland, 1996.

Suomen taloushistoria, Historiallinen tilasto 3, 1983.

Vasenius, Valfrid, Suomalainen kirjallisuus, 1544-1877, 1878.

Gardberg, Carl-Rudolf, Kirjapainotaito Suomessa I-III, 1949-1973.

Heininen, Simo, Ulkomaisen kirjallisuuden tulo Suomeen 1531-1600. SKHSV, 1991.

Häkli, Esko, Näin syntyi ja säilyi suomalainen kirja, 1989.

Laine, Tuija, Vanhimman suomalaisen kirjallisuuden käsikirja, 1997.

Vieraskielinen kirjallisuus Suomessa Ruotsin vallan aikana.

Wittman, Reinhard, Was there a reading revolution at the end of the eighteenth century? A history of reading in the west. Cambridge, 2003.

Aatehistoria ja digitaalisten aineistojen mahdollisuudet `r citep(bib[["Tolonen15EnnenNyt"]])` 

We have prepared open data analytical ecosystem for in-depth analysis
of such data collections `r citep("10.18352/lq.10112")`.

You can cite with the DOI (the citation info will then be collected automatically): `r citep("10.18352/lq.10112")` or alternatively add new references to the [bib
file](bibliography.bib) and then cite using the key with
`r citep(bib[["Lahti15LIBER"]])`. Such citations will be automatically
numbered and collected in references section.

- Knowledge production has been approached largely through a national perspective, here we shift focus by combining materials from Sweden and Finland and by specifically looking at cities as sites for knowledge production. Cities are to this effect seen as partly supplementing, partly competing intellectual centres.



## Results

Why Fennica has huge drop in 1700s. Do some publisher disappear (TODO). Let us look at top publication places during the period 1650-1750 in Fennica: 

```{r drop1700, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=6, out.width="280px"}

  catal = "Fennica"
  minyear = 1650
  maxyear = 1750
  df = subset(df0, catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year < maxyear)
  mydf = df

selected.places = names(top(mydf, "publication_place", 6))

for (myplace in selected.places) {

  df = subset(mydf, publication_place == myplace)

  # Use timeinterval year intervals
  timeinterval <- 5
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot(data = dfm, aes(x = date, y = Documents))
  p <- p + geom_line(col = "black")
  #p <- p + geom_smooth(col = "black")  
  p <- p + geom_point(col = "black", size = 3)
  p <- p + scale_x_continuous(breaks = seq(minyear, maxyear, 20), limits = c(minyear, maxyear))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + scale_y_continuous(limits = c(0, 100))  
  p <- p + ggtitle(paste(myplace, " (", catal, ")", sep = ""))
  
  print(p)
}
```





TODO: try check duplicates. Clustering with identical place, identical year, near identical title and then print table with potential duplicates for manual checks.

TODO (uusi, juhannustaika): Hartauskirjallisuuden kieli (suomi vai ruotsi) milloin alkaa yleistyä suomenkielinen ja miten tämän julkaiseminen suomeksi kasvaa? Muutenkin näitä suomi vs. ruotsinkieli kysymyksiä kannattaa yrittää toteuttaa. Mm. yleinen vertailu suomenkielisestä materiaalista ja ruotsinkielisestä materiaalista Fennicassa. Hartauskirjallisuuden osalta jos tämä näyttää järkevältä tarkastelukohdalta, niin sitten kannattaa tältä osin jatkaa analyysi myös 1828 eteenpäin suomenkielisen aineiston osalta niin pitkälle kuin Fennicassa riittää aineistoa.

### General trends: Fennica vs. Kungliga

Relevant summaries can be moved here and polished. Which figures at least ? Just let me know and I will add.

  * [Fennica overview](https://github.com/rOpenGov/fennica/blob/master/inst/examples/overview.md)
  * [Kungliga overview](https://github.com/rOpenGov/kungliga/blob/master/antagomir/overview.md)  


Overall development in publishing activity:

```{r publishingovertime, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=10, out.width="430px"}
df2 <- df0 %>% group_by(publication_decade, catalog) %>% summarise(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n())
df2$catalog = factor(df2$catalog, levels = rev(c("Fennica", "Kungliga")))
p <- ggplot(df2, aes(x = publication_decade, y = n)) +
     #geom_bar(stat = "identity") + #scale_y_log10() +
     geom_line(aes(linetype = catalog)) +
     geom_point(aes(shape = catalog), size = 3) +     
     #ylab("Paper consumption (km2)")
     ylab("Title count (n)") + xlab("Publication year") +  
     ggtitle("Overall publishing activity")
print(p)
```


The top publication places ranked by the title count

```{r LIBER-topplace, echo=FALSE, message=FALSE, cache=FALSE, fig.height=6, fig.width=12}
theme_set(theme_bw(20))
ntop = 10
p <- top_plot(fen, "publication_place", ntop = ntop)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title count (Log10 scale)")
p <- p + scale_y_log10()
p <- p + ggtitle("Top publication places\n(Fennica)")
pf = p

theme_set(theme_bw(30))
p <- top_plot(kun, "publication_place", ntop = ntop)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title count (Log10 scale)")
p <- p + scale_y_log10()
p <- p + ggtitle("Top publication places\n(Kungliga)")
pk = p

grid.arrange(pf, pk, nrow = 1)
```


Comparison of printing activity in Turku, Uppsala, Lund, and
Stockholm. Turussa julkaiseminen alkaa vasta 1640-luvulla, mutta
ollaan kiinnostuttu ruotsalaisesta julkaisemisesta ennen sitä. Esim
miten Turun yliopiston perustaminen vaikuttaa ruotsalaiseen
julkaisukenttään 1600-luvun aikana. I can provide percentages instead
of counts, or paper consumption estimates (not reliable yet, though),
barplots, selected time spans, selected places etc.. just let me know
what is needed.

```{r publishingactivitycomparisons, echo=FALSE, message=FALSE, cache=FALSE, fig.width=8, fig.height=6, fig.show="hold", out.width="430px"}
selected.places = c("Turku", "Uppsala", "Lund", "Stockholm")
df2 <- df0 %>% group_by(publication_decade, publication_place, catalog) %>%
               summarise(n = n()) %>%
               #summarise(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n()) %>%	       
	       filter(publication_place %in% selected.places) # %>%
	       #filter(publication_decade >= 1600)
df2$catalog = factor(df2$catalog, levels = rev(c("Fennica", "Kungliga")))
df2$publication_place = droplevels(factor(df2$publication_place))
df3 = spread(df2, publication_decade, n, fill = 0)
df2 = melt(df3)
colnames(df2) = c("publication_place", "catalog", "publication_decade", "n")
df2$publication_decade = as.numeric(as.character(df2$publication_decade))
df2$n = as.numeric(as.character(df2$n))
for (catal in unique(df2$catalog)) {

  p <- ggplot(subset(df2, catalog == catal), aes(x = publication_decade, y = n)) +
     geom_line(aes(linetype = publication_place)) +
     geom_point(aes(shape = publication_place), size = 3) +
     #scale_y_log10() +
     #facet_wrap(catalog ~ .) + 
     ylab("Title count (n)") + xlab("Publication year") +  
     ggtitle(catal)
  print(p)

}
```


### Effects of historical events 

**Riksdagar** are in some cases associated with publishing peaks (see
Figure ...). See "Vapauden ajan valtiopäivät" from 1719 onwards ?

In particular: Riksdag Stockholm 20 januari 1719 1 juni 1719; Stockholm 14 maj 1734 14 december 1734; Stockholm 21 februari 1765 21 oktober 1766; Norrköping & Stockholm 22 april 1769 5 februari 1770; Stockholm 19 juni 1771 12 september 1772; Gävle 26 januari 1792 24 februari 1792.

The publishing of historical works in .. on a timeline highlighting the eras of the riksdagar (16..-16..).. 


**Painovapaus**, 1766, räjähtääkö / kasvaako julkaiseminen merkittävästi
ja miten tämä näkyy Tukholma vs. muu valtakunta (ml. Turku)?
Painovapaus on 1766-1772, miten tämä näkyy ?


```{r riksdar1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6, fig.show="hold", out.width="430px"}
for (catal in as.character(unique(df0$catalog))) {

  # Use timeinterval year intervals
  dfsel = subset(df0, catalog == catal)
  #dfsel = subset(df0, publication_place == "Stockholm")
  #dfsel = subset(df0, publication_place == "Norrköping")
  #dfsel = subset(df0, publication_place == "Gävle")

  df <- subset(dfsel, publication_year >= 1700 & publication_year < 1800 )

  timeinterval <- 1
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))
  ymin = min(dfm$Documents)
  ymax = max(dfm$Documents)

  rect_left <- c(min(na.omit(dfm$date)),
               1719-.5, 1719+.5, # Stockholm 20 januari 1719 1 juni 1719
               1734-.5, 1734+.5, # Stockholm 14 maj 1734 14 december 1734
               1765-.5, 1766+.5, # Stockholm 21 februari 1765 21 oktober 1766
               1769-.5, 1770+.5, # Norrköping & Stockholm 22 april 1769 5 februari 1770
               1771-.5, 1772+.5, # Stockholm 19 juni 1771 12 september 1772
               1792-.5, 1792+.5, # Gävle 26 januari 1792 24 februari 1792	       
               max(na.omit(dfm$date)))
  rectangles <- data.frame(
    xmin = rect_left[-length(rect_left)],
    xmax = rect_left[-1],
    ymin = ymin,
    ymax = ymax
    )
  rectangles$shade <- rep(c("White", "Highlight"), length = nrow(rectangles))

 riksplace = c("Stockholm", "Stockholm", "Stockholm", "Norrköping", "Stockholm", "Gävle")
 cols = c("gray", "lightblue", "yellow", "white")
 rectangles$shade[rectangles$shade == "Highlight"] = riksplace
 rectangles$shade = factor(rectangles$shade)

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot()
  p <- p + geom_rect(data = rectangles, 
	   aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax, fill=shade), alpha=0.8) + 
         scale_fill_manual(values = cols) # + guides(fill = "none") 
  p <- p + geom_line(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + geom_point(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + scale_x_continuous(breaks=seq(min(dfm$date), max(dfm$date), 20))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(catal)
  print(p)
}
```


Focus on Gävle (gray) during riksdagar. Gävle has `r sum("Gävle" %in% fen$publication_place)` occurrences in Fennica, hence not included here. The figure on Gävle is based on Kungliga.

```{r riksdar2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=7, out.width="430px"}

  # Use timeinterval year intervals
  myplace = "Gävle" # Norrköping / Stockholm
  minyear = 1700
  maxyear = 1800
  catal = "Kungliga"

  df = subset(df0, publication_place == myplace & catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year < maxyear)

  timeinterval <- 1
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))
  ymin = min(dfm$Documents)
  ymax = max(dfm$Documents)

  rect_left <- c(min(na.omit(dfm$date)),
               1719-.5, 1719+.5, # Stockholm 20 januari 1719 1 juni 1719
               1734-.5, 1734+.5, # Stockholm 14 maj 1734 14 december 1734
               1765-.5, 1766+.5, # Stockholm 21 februari 1765 21 oktober 1766
               1769-.5, 1770+.5, # Norrköping & Stockholm 22 april 1769 5 februari 1770
               1771-.5, 1772+.5, # Stockholm 19 juni 1771 12 september 1772
               1792-.5, 1792+.5, # Gävle 26 januari 1792 24 februari 1792	       
               max(na.omit(dfm$date)))
  rectangles <- data.frame(
    xmin = rect_left[-length(rect_left)],
    xmax = rect_left[-1],
    ymin = ymin,
    ymax = ymax
    )
  rectangles$shade <- rep(c("White", "Highlight"), length = nrow(rectangles))

 riksplace = c("Stockholm", "Stockholm", "Stockholm", "Norrköping", "Stockholm", "Gävle")
 cols = c("gray", "lightblue", "yellow", "white")
 rectangles$shade[rectangles$shade == "Highlight"] = riksplace
 rectangles$shade = factor(rectangles$shade)

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot()
  p <- p + geom_rect(data = rectangles, 
	   aes(xmin=xmin, xmax=xmax,
	       ymin=ymin, ymax=ymax,
	       fill=shade), alpha=0.8) + 
         scale_fill_manual(values = cols) # + guides(fill = "none") 
  p <- p + geom_line(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + geom_point(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + scale_x_continuous(breaks = seq(minyear, maxyear, 20))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(paste(myplace, " (", catal, ")", sep = ""))
  print(p)
```


Title counts in selected places in the Kungliga catalogue.


```{r selectedplaces, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=6, out.width="280px"}
selected.places = c("Tartu", "Skara", "Växjö", "Uppsala", "Lund", "Strängnäs", "Linköping", "Gothenburg", "Västerås", "Nyköping", "Norrköping", "Stockholm", "Turku")
for (myplace in selected.places) {
  # Use timeinterval year intervals
  catal = "Kungliga"
  minyear = 1500
  #maxyear = 1800
  #minyear = min(na.omit(df0$publication_year))
  #maxyear = max(na.omit(df0$publication_year))  

  df = subset(df0, publication_place == myplace & catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year < maxyear)

  timeinterval <- 5
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot(data = dfm, aes(x = date, y = Documents))
  p <- p + geom_line(col = "black")
  p <- p + geom_smooth(col = "black")  
  p <- p + geom_point(col = "black", size = 3)
  p <- p + scale_x_continuous(breaks = seq(minyear, maxyear, 20), limits = c(minyear, maxyear))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(paste(myplace, " (", catal, ")", sep = ""))
  print(p)
}
```


Kungliga publications outside Sweden and Finland.

```{r selectedplaces2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=6, out.width="600px"}

  # Use timeinterval year intervals
  catal = "Kungliga"
  minyear = 1500
  #maxyear = 1800
  #minyear = min(na.omit(df0$publication_year))
  #maxyear = max(na.omit(df0$publication_year))  

  df = subset(df0, !country %in% c("Finland", "Sweden") & catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year < maxyear)

  timeinterval <- 5
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot(data = dfm, aes(x = date, y = Documents))
  p <- p + geom_line(col = "black")
  p <- p + geom_smooth(col = "black")  
  p <- p + geom_point(col = "black", size = 3)
  p <- p + scale_x_continuous(breaks = seq(minyear, maxyear, 20), limits = c(minyear, maxyear))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(paste("Outside of Sweden and Finland", " (", catal, ")", sep = ""))
  print(p)

```


### Book printing in Finland 

mitä voidaan sanoa suomalaisesta kirjatuotannosta ylipäänsä sekä
löydetäänkö sieltä mitään mielenkiintoisia kehityskulkuja ylipäänsä
vai pelkästään toteamus, että suomalainen tiedontuotanto oli hyvin
vähäistä tarkastellulla ajanjaksolla.


### Book as media: development over time


Paper consumption per document in the top publication places. Note
that paper consumption estimates have still problems so take this with
reservations. Are there time periods with remarkable changes in paper
consumption per document (meaning that small or large volumes suddenly
become more frequent) ?


```{r bookmedia2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=7, fig.show="hold", out.width="430px"}
for (catal in as.character(unique(df0$catalog))) {
  df <- subset(df0, catalog == catal)
  theme_set(theme_bw(20))
  top <- names(top(df, "publication_place", 10))

  dfs <- df %>% filter(publication_place %in% top) %>% group_by(publication_decade, publication_place, country) %>% summarize(n = n(), paper = sum(paper.consumption.km2, na.rm = T))  %>% mutate(paper.per.document = paper/n)

  p <- ggplot(dfs, aes(x = publication_decade, y = paper.per.document)) +
       geom_point(aes(color = publication_place, shape = publication_place)) +
       geom_line(aes(color = publication_place, linetype = publication_place)) +
       xlab("Title Count") + 
       ggtitle(paste("Paper consumption per document\n", catal)) +
       scale_y_log10() 
  #p <- p + geom_text(aes(label = publication_place), size = 5)
  #p <- p + xlab("Title Count") + ylab("Paper consumption (km2)")
  #p <- p + scale_color_manual(values = c("darkgray", "black"))
  #p <- p + guides(color = "none")
  print(p)	 
}
```




Overview on how over 50 page documents spread in time. Paper
consumption in books (over 50 pages; balls) versus other documents
(less or equal than 50 pages; triangles). TODO: voidaanko tässä nähdä
paikallisia eroja ?

```{r bookmedia1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=7, fig.show="hold", out.width="430px"}
for (catal in unique(df0$catalog)) {
  df2 <- subset(df0, catalog == catal)
  pagelimit = 50
  df2$document.type <- rep(NA, nrow(df2))
  df2$document.type[df2$pagecount > pagelimit] <- "book"
  df2$document.type[df2$pagecount <= pagelimit] <- "pamphlet"
  df2 <- df2[which(!is.na(df2$document.type)),]
  df2$document.type <- factor(df2$document.type)
  df2 <- df2 %>% group_by(publication_decade, document.type) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
  p <- ggplot(df2, aes(x = publication_decade, y = paper.consumption.km2, group = document.type))
  p <- p + geom_point(aes(shape = document.type), size = 5)
  p <- p + geom_smooth(method = "loess", color = "black")
  p <- p + ggtitle("Paper consumption per document type")
  p <- p + xlab("Year")
  p <- p + ylab("Paper consumption (km2)")
  p <- p + scale_color_manual(values=c("black", "darkgray"))
  # p <- p + guides(shape = "none") 
  p <- p + ggtitle(catal)
  print(p)
}
```


Average paper consumption per document over time:

```{r LIBER-11, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=8, fig.width=12, out.width="600px"}
theme_set(theme_bw(25))
library(sorvi)
dfs <- df0 %>% group_by(publication_decade) %>%
         summarize(paper.per.doc = mean(paper.consumption.km2, na.rm = T))
p <- ggplot(dfs, aes(y = paper.per.doc, x = publication_decade)) +
       geom_point() + geom_smooth(method = "loess", size = 1, color = "black") +
       xlab("Publication year") + ylab("Paper per document") +
       ggtitle("Average paper consumption per document")
print(p)
```




The development of book formats over time. Folios (1to ja 2to) are
largely missing (in contrast to ESTC). Moreover, the quarto (4to) and
octavo (8vo) increase rapidly in 1700s.


```{r papercompbyformat, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=7, fig.show="hold", out.width="430px"}
for (catal in unique(df0$catalog)) {
  dfs <- df0 %>% filter(!gatherings == "NA" & catalog == catal) 

  res <- titlecount_timeline(dfs, "gatherings", nmin = 15, mode = "n") 
  print(res$plot + ggtitle(paste(catal, " (n)", sep = "")))
 
  res <- titlecount_timeline(dfs, "gatherings", nmin = 15, mode = "percentage") 
  print(res$plot + ggtitle(paste(catal, " (%)", sep = "")))
}
```


Paper consumption for different document formats over time. Each point represents a decade. Loess smoothing. 

```{r LIBER-13, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=10, fig.height=8, fig.show="hold", out.width="430px"}
for (catal in unique(df0$catalog)) {
  df2 <- subset(df0, catalog == catal) %>% group_by(publication_decade, gatherings) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
  df2 <- filter(df2, gatherings %in% setdiff(names(which(table(df2$gatherings) >= 15)), "NA"))
  p <- ggplot(df2, aes(y = paper.consumption.km2, x = publication_decade, shape = gatherings, linetype = gatherings))
  p <- p + geom_point(size = 4)
  p <- p + geom_smooth(method = "loess", size = 1, color = "black")
  p <- p + ggtitle("Paper consumption in time by gatherings")
  p <- p + xlab("Year")
  p <- p + ylab("Paper consumption (km2)")
  p <- p + guides(linetype = guide_legend(keywidth = 5), shape = guide_legend(keywidth = 5))
  p <- p + ggtitle(paste("Paper consumption\n(", catal, ")", sep = ""))
  print(p)
}
```


Paper consumption in selected places (Fennica):

```{r 201606krakow-turkuvsother, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=10, fig.show="hold", out.width="430px"}
df <- fen %>% 
      filter(!is.na(country)) %>%
      filter(!is.na(publication_place) & !is.na(paper.consumption.km2) & paper.consumption.km2 > -0.01)

# Add indicator field: Turku or Not Turku
myplace <- "Turku"

df$myplace <- rep(NA, nrow(df))
df$myplace[df$publication_place == myplace] <- myplace
df$myplace[!df$publication_place == myplace & df$country == "Finland"] <- "Finland"
df$myplace[!df$country == "Finland" & !df$publication_place == myplace] <- "Foreign"
df$myplace <- factor(df$myplace, levels = rev(c("Foreign", "Finland", "Turku")))

# Keep entries with known publication place and paper consumption
# Group by year/decade and Turku/Other
dfs <- df %>% group_by(publication_decade, myplace) %>%
  summarise(titles = n(), paper = sum(paper.consumption.km2, na.rm = TRUE))

p <- ggplot(dfs, aes(x = publication_decade, y = paper, fill = myplace, order = -as.numeric(myplace))) +
     geom_bar(position = "stack", stat = "identity", color = "black") +
     ggtitle("Paper consumption") +
     #scale_fill_manual(values = c("blue", "black", "darkgreen")) +
     scale_fill_grey() +
     guides(fill = guide_legend(reverse = TRUE, title = "")) + 
     xlab("Publication decade") + ylab("Paper (km2)")
print(p)


p <- ggplot(dfs, aes(x = publication_decade, y = titles, fill = myplace, order = -as.numeric(myplace))) +
     geom_bar(position = "stack", stat = "identity", color = "black") +
     ggtitle("Title count") +
     # scale_fill_manual(values = c("blue", "black", "darkgreen")) +
     scale_fill_grey() +
     guides(fill = guide_legend(reverse = TRUE, title = "")) +      
     xlab("Publication decade") + ylab("Title count (n)")
print(p)
```


### Publisher analysis

Puhutaan julkaisijatoiminnan kehityksestä ikään kuin luonnollisena
kehityksenä - eli yhteys luonnonilmiöiden kehitykseen säilyisi.

Pystytäänkö julkaisemiseen liittyvästä Fennica-datasta erottelemaan
selkeitä trendejä suomalaisesta tiedontuotannosta 1640-1828, pääfokus
julkaisijat: Miten uusia julkaisijoita tulee julkaisijakenttään
Suomessa ja katoaa. Pääpaino erityisesti sillä kun julkaisijakartalle
tulee uusia toimijoita! [TÄHÄN VOISI MIETTIÄ KARTTAKUVIEN SARJAA TAI
STACKED BARPLOTTIA JONKA DIVERSITEETTI KASVAA]

Toimijoita voisi myös yrittää luokitella suhteellisesti (“iso”,
“keskikokoinen”, “pieni”) liittyen vuosittaiseen julkaisuvoluumiin
jota mitataan niin julkaisujen määrän kuin myös paperinkulutusvoluumin
suhteen. Vertailua suurimpien julkaisijoiden kesken.

Analyysia voisi tästä tehdä sitten näiden luokkien kehityksen
mukaan. “Siinä missä Londicer 1700-luvun Vaasassa näyttää aina
julkaisseen asetukset jonkinlaisena kokoomapainoksena, mutta
Frenckellin kirjapainosta ne tuli yksitellen. Siten Frenckellin
julkaisemien niteiden määrä saattaa näyttää suurelta verrattuna
Londiceriin, mutta itse asiassa sisältömäärä on sama”. → Tämä
hypoteesi voidaan todentaa/tarkistaa/korjata kun mukana on
paperinkulutus!

Julkaisijoiden ilmentyminen kartalle paperinkulutusvoluumi huomioiden:
julkaisutoiminnan leviäminen ja kasvu ajassa eri
paikkakunnilla. Paperinkulutus voi osoittautua hyväksi työvälineeksi
erityisesti kun tiedetään, että toiset isot julkaisijat julkaisivat
esim. jotain asetuskokoelmia yksittäin ja toiset taas ryppäinä. Eli
julkaisijoiden sisällä erottelua eri tyyppisten julkaisujen suhteen
pitää tehdä.

Julkaisijoista tehtävä verkostoanalyysi. keskeisimmät “nodet” siihen
miten julkaisijakenttä muuttuu ajassa. Julkaisijoita voisi myös
yrittää luokitella eniten käytettyjen asiasanojen mukaan. Näiden
perusteella voidaan varmaankin erotella yliopistojulkaiseminen,
asiakirja/asetusjulkaiseminen ja kirjajulkaiseminen. Tämän jälkeen
auktorit, valtioasiakirjat, yliopistodokumentit, kirjat ja muut
julkaisut kategoroina joiden ympärille verkostoanalyysi voisi syntyä
(valtionasiakirjojen ja yliopisto-aineiston luokittelu voisi yhdistää
myös asiasanojen ja otsikoiden analyysia). [OK monenlaista voidaan
tehdä, onko tämä asiasanajuttu nyt tärkeä vai vähemmän tärkeä
prioriteetti?]




### University publishing

Yliopistojulkaisuista mahd. pian yleiset tilastolliset näkymät ja
voidaan sitten arvioida onko joku mahdollisesti pahastikin vielä
pielessä esim. väitöskirjoiksi Kungligan osalta luokiteltavissa
aineistoissa.

Yleinen tilasto "väitöskirjaksi" merkityistä teoksista (aikajana,
julkaisupaikka) olisi hyvä Kungligan osalta. Tämä toimii lähtökohtana
että nähdään sisällöstä jotain: milloin niitä väitöskirja-luokiteltuja
teoksia Kungligassa on merkitty julkaistuiksi sekä missä. Tämän
vertaaminen Fennican pohjalta samaan eli "väitöskirjaksi" täggättyihin
on tärkeää.

analyysi mitä julkaisukentällä tapahtuu eri paikoissa kun uusia
julkaisijoita tulee kartalle (meneekö esim. jossain toisessa
yliopistossa tuotanto suhteessa alas kun matkan varrella tulee uusia
yliopistoja vai ei) jne.

Yliopistojen ilmestyminen ruotsinvaltakunnassahan on (ks. aikajanat):

Uppsala: 1477

Tartu / Dorpat / Tarto (eikös paikkakunnittain synonyymit toimi jo?): 1633

Turku: 1640

Lund: 1666

Greifwald: 1456 (Ruotsin systeemissä 1600-1815)

Greifswald mukaan yliopistoanalyysiin. osana Ruotsin valtakuntaa.

Tätä kautta päästään hyvin kiinni Turku, Upsala,
Lund, Tarto yms. vertailuihin. Siitä sitten kuljetaan kohti Turun
suhdetta muuhun Suomeen ja katso kääntyy erityisesti julkaisijoihin
(samaten toki myös noiden yliopistokaupunkien osalla, jossa myös
tehdään sitten vertailua akateeminen vs. hallinnollinen vs. muu
julkaisutoiminta).


**Dissertation language** milloin alkaa erityisesti tulemaan ruotsinkielellä väitöksiä eri paikoissa on mielenkiintoinen kysymys. tuleeko jostain yliopistosta
erityisesti ruotsinkielistä materiaalia 1700-luvulla.  pitää
erityisesti analysoida niitä väitöskirjoja sekä niissä tapahtuvia
muutoksia. See [Fennica](https://github.com/rOpenGov/fennica/blob/master/inst/examples/language.md) and [Kungliga](https://github.com/rOpenGov/kungliga/blob/master/antagomir/language.md),



### Case of Turku

Turun akateemisen julkaisemisen vertautuminen muihin ruotsalaisen
yliopistojärjestelmän kaupunkeihin: Lukumäärävertailut
aikajanalla. Akateemisten julkaisujen blokkaaminenhan ei pitäisi olla
kovinkaan hankalaa [väitöskirjat, mitä muuta tähän siis?]. 

Turku vs. muu Suomi: Turku osana ruotsalaista yliopistojärjestelmää
(ml. Tarto) muuttuu tärkeäksi).

Kuinka paljon yliopistoon liittyvää julkaisutoimintaa

Kuinka paljon julkaisijoita

Miten julkaisijoiden verkosto muodostuu Turussa

Miten eri julkaisijoita Turussa voitaisiin luokitella (julkaiseeko
joku paperinkulutukseltaan vain pieniä dokumentteja, julkaiseeko joku
painotalo huomattavasti enemmän kuin toiset).


### Other points if the time allows

Vertailukohtia CERListä tai sitten ehkä ESTCstä pitää ottaa Fennicalle
että pystytään suhteuttamaan mistä puhutaan [verratkaa vaikka aiempiin
julkaisuihin, ei sotketa enempää katalogeja nyt tähän soppaan ?]

Ks myös Subject topics ainakin yliopisto-väitöskirjoihin liittyen.

tuleeko uusia kustantajia kenttään valtiopäivien myötä ? 

 * Fennica pois lukien Suomi ?
 * Kungliga pois lukien Ruotsi ?

[Topic](https://github.com/rOpenGov/kungliga/blob/master/antagomir/topic.md)
saadaanko mitään irti (1470-1830 tai 1640-1830).

Further todo points. Let us move in this manuscript only those points
that there is time to do.

 * [Fennica TODO](https://github.com/rOpenGov/fennica/blob/master/inst/examples/TODO.md)
 * [Kungliga TODO](https://github.com/rOpenGov/kungliga/blob/master/antagomir/TODO.md)







## Conclusions

Library catalogues contain rich metadata on...

Here we have analysed Fennica & Kungliga.. 

Further draft text in the funding application..?




## Materials and Methods

We obtained Fennica and Kungliga library catalogues from..

The raw data contains metadata `r nrow(fenraw)` and `r nrow(kunraw)` documents in Fennica and Kungliga, respectively. We limited the present analysis in the time interval `r min(df0$publication_year)`-`r max(df0$publication_year)`, yielding a subset of `r nrow(subset(df0, catalog == "Fennica"))` (`r round(100*nrow(subset(df0, catalog == "Fennica"))/nrow(fenraw), 1)`%) and `r nrow(subset(df0, catalog == "Kungliga"))` (`r round(100*nrow(subset(df0, catalog == "Kunliga"))/nrow(kunraw), 1)`%) documents for Fennica and Kungliga, respectively.



We have prepared open data analytical ecosystem for in-depth analysis of such data collections ([Lahti, Ilomaki, Tolonen (2015)](http://doi.org/10.18352/lq.10112)). In summary, the data analytical ecosystem does .. Reading, parsing, cleaning up, enriching, summarizing, analysis, visualization, figures and tables.. [SUMMARY FIGURE OF THE PROCESS?]. Full source code to reproduce these analyses are available via Github ([Fennica](https://github.com/rOpenGov/fennica/); [Kungliga](https://github.com/rOpenGov/kungliga/)).

A brief summary of the data processing steps:

**Author names**

**Author life years**

**Publication place**

**Publishers**

**Dissertations** 

**Duplicate removal** Combining the catalogs ..

**Enriching** to add gender, country, geocoordinates ..


The package utilizes tools from a number of other R extensions,
including dplyr `r citep(citation("dplyr"))`, ggplot2 `r citep(citation("ggplot2"))`, stats `r citep(citation("stats"))`, tidyr `r citep(citation("tidyr"))`.




### Acknowledgements

Supported by Academy of Finland (grant 293316).


## References

### References

```{r, echo=FALSE, message=FALSE}
#Embed citations from bib files with `r citep(bib[["lahti14natcomm"]])`. Or with @lahti14natcomm
#You can embed citations, for example: `r citep(bib[["lahti14natcomm"]])`
#You can embed citations, for example2: @lahti14natcomm
#Cite with DOI: `r citep("10.1890/11-0011.1")`
#Cite URL `r citep("http://knowledgeblog.org/greycite")`
#For automated markdown citations, check [this](http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html), [this](https://github.com/cboettig/knitcitations), and [this](http://www.carlboettiger.info/2012/03/24/citations-in-markdown-using-knitr.html). 
#write.bibtex(file="references.bib")
```

```{r, echo=FALSE, message=FALSE, results='asis'}
bibliography(sorting = 'ynt')
```

## Miscellaneous ideas to consider

[ESTC-analyses](https://github.com/rOpenGov/estc)
([LIBER](https://github.com/rOpenGov/estc/blob/master/inst/examples/20151023-LIBER.md)
in particular); toisto Fennica/Kungliga datoilla ? LL: lisäilin
joitain analyyseja tahan mutta jos tahdotte lisaa niin pyytakaa
erikseen.


The most active known female authors based on the title count:

```{r 201606krakow-fennica-topfemale, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=5, fig.width=20, out.width="850px"}
theme_set(theme_bw(10))
dfs <- fen %>% filter(author_gender == "female")
p <- top_plot(dfs, "author", ntop = 20)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title count")
p <- p + ggtitle("Top female authors\n(Fennica)")
p <- p + theme(axis.text.x = element_text(size = 16), axis.text.y = element_text(size = 16), axis.title.x = element_text(size = 25), axis.title.y = element_text(size = 22), title = element_text(size = 22))
pf = p

theme_set(theme_bw(20))
dfs <- kun %>% filter(author_gender == "female")
p <- top_plot(dfs, "author", ntop = 20)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title count")
p <- p + ggtitle("Top female authors\n(Kungliga)")
p <- p + theme(axis.text.x = element_text(size = 16), axis.text.y = element_text(size = 16), axis.title.x = element_text(size = 25), axis.title.y = element_text(size = 22), title = element_text(size = 22))
pk = p

library(gridExtra)
grid.arrange(pf, pk, nrow = 1)
```





## Session info

This document was created with the following versions:

```{r sessioninfo, message=FALSE, warning=FALSE}
sessionInfo()
```





