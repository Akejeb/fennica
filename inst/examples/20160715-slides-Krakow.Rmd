---
title: "Printing in a Periphery: a Quantitative Study of Finnish Knowledge Production, 1640-1828"
author: "Mikko Tolonen, Jani Marjanen, Hege Roivainen, Leo Lahti"
date: "`r Sys.Date()`"
output: 
  beamer_presentation:
    theme: "boxes"
    colortheme: "orchid"
    fonttheme: "professionalfonts"
---

```{r 201606krakow-init, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}
# Default time span
min.year <- 1488
max.year <- 1828

library(ggmap)
library(gisfin)
library(stringr)
library(dplyr)
library(tidyr)
library(reshape2)
library(ggplot2)
library(bibliographica)
library(fennica)
library(sorvi)
library(devtools)
# install_github("ropengov/gisfin")
# devtools::install_github('cttobin/ggthemr')
library(gisfin)
#library(ggthemr)

knitr::opts_chunk$set(echo = FALSE)
#knitr::opts_chunk$set(fig.path = "slides_201606_Krakow/", dev="CairoPNG")
knitr::opts_chunk$set(fig.path = "slides_201606_Krakow/")

# Set locale
tmp <- Sys.setlocale(locale="UTF-8") 

# Nice theme
theme_set(theme_bw(26))

# Nice default themes
# https://github.com/cttobin/ggthemr#palettes
#ggthemr('fresh', text_size = 20)
# ggthemr('greyscale', text_size = 20)
#ggthemr('light', text_size = 20)
# ggthemr('pale', text_size = 20)
#ggthemr_reset() # Reset theme
```


```{r 201606krakow-init2, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}
# Full combined catalogue (Fen + Kun) with marked duplicates
df.combined.preprocessed <- readRDS("df.combined.Rds")
# Data with duplicates removed
df.full <- df.combined.preprocessed %>% filter(!remove)
# Data with years limited as well
df0 <- df.full %>% filter(publication_year >= min.year & publication_year <= max.year)
```

---


### TODO

sivu 27. Dissertation languages: kategoria "other" sisällön selvittäminen!

Yleisesti eri kuvien tekstit yms. tsekkaaminen, korostukset yms.

---

## From particular data to global perspective?

**Idea**: Study early modern knowledge production, all of it (1470-1830)  

**How?** Combine library catalogues (Fennica, Kungliga, ESTC, CERL HPB database)  

**Important**: cleaning up the data (90% of the effort!) and considering how particular data collections (Finnish National Bibliography, English Short-Title Catalogue etc.) have been formed.  

**How to fail**: take worldcat or similar combination of datasets and analyse it as a whole without cleaning it up first.  

**Overcoming a national gaze** by focus on knowledge production through more complex cross-national network of cities

---

### Data: bibliographic catalogues 1640-1828  

**Fennica** Finnish National bibliography

- `r nrow(subset(df0, catalog == "Fennica" & publication_year >= 1640 & publication_year < 1828))` documents 1640-1828

**Kungliga**  Swedish National bibliography

- `r nrow(subset(df0, catalog == "Kungliga" & publication_year >= 1640 & publication_year < 1828))` documents 1640-1828

- **Visible roots of the diversity of "Finnishness" reflected in knowledge production, 1640-1828**

```{r, message=FALSE, warning=FALSE, fig.width=10, fig.height=3, echo=FALSE}
library(dplyr)
library(ggplot2)
theme_set(theme_bw(20))
df <- df0 %>% filter(publication_year >=1640 & publication_year <=1828) %>% group_by(catalog, publication_decade) %>% tally()
p <- ggplot(df, aes(x = publication_decade, y = n, color = catalog)) + 
       geom_point() + 
       geom_line() + 
       ylab("Documents (n)") + xlab("Publication year") +
       scale_color_manual(values = c("blue", "darkgreen")) + 
       guides(fill = guide_legend(reverse = TRUE, title = "")) #+ 
print(p)
```

---


## Methods: Open data analytical ecosystem

**Customized** dedicated R packages for bibliographic analysis combine flexibility with automation

**Automated** scales well with new data and unforeseen changes; a million documents ~ 30 minutes

**Open source** fully transparent and reproducible data analytics: https://github.com/rOpenGov/fennica

**Collaboration & Reuse** further use and enrichment

**Research potential** greatly underestimated; world is full of metadata collections

![Data Science Workflow](data-science.png)  
\tiny{(Figure by Hadley Wickham)}


---



## Preprocess & Enrich

```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(bibliographica, quiet = TRUE)
```

**Clean up messy entries**

```{r, message=FALSE, warning=FALSE,echo=TRUE}
polish_physical_extent("iii-xxiv, 118, [2] p.")$pagecount
```


**Augment data** (geocoordinates, gender, ..)

```{r, message=FALSE, warning=FALSE}
get_country("Porvoo")
```

---


### Outline of Quantitative Study of Finnish Knowledge Production, 1640-1828

1) General trends & political events

2) Publishers in Sweden and Turku

3) Languages & religious texts in Finland

4) University curriculum & Enlightenment in Finland

Visible roots of the diversity of "Finnishness" reflected in knowledge production, 1640-1828.

---



**1. General trends & political events**


---

[General trends & political events]

### Turku as a Swedish University Town among Uppsala, Tartu and Stockholm

```{r map1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=20, fig.height=5, eval=TRUE}
library(dplyr)
library(ggmap)
library(ggplot2)
library(gisfin)
source("funcs.R")
theme_set(get_theme_map())
mapdata <- filter(df0,
          (catalog == "Kungliga" &
	      publication_place %in% c("Stockholm", "Uppsala",
	                         "Greifswald", "Lund", "Tartu"))|
	  (catalog == "Fennica" &
	      publication_place == "Turku")) %>%
      group_by(publication_decade, publication_place,
	       latitude, longitude) %>%
      summarise(n = n()) 

mapdata$size <- mapdata$n
mapdata$highlight <- rep("black", nrow(mapdata))
mapdata$highlight[mapdata$publication_place %in% c("Turku")] <- "red"
mapdata$highlight <- factor(mapdata$highlight)

region <- "Europe.north"
mymap <- get_map(location=geobox(region), color = "bw",
                  source="google",  maptype="terrain")

p0 <- ggmap(mymap) + theme(legend.position="none")

pics <- list()
for (i in c(1650, 1710, 1760, 1800)) {
  
    # Plot map
    p <- p0

    # Pick the investigated period (sliding window)
    # Sum up the years within this sliding window for each element    	    
    dfw <- subset(mapdata, publication_decade == i) %>%
    	     group_by(publication_place, latitude, longitude, highlight) %>%
		       summarize(n = sum(size))

    if (nrow(dfw) > 0) {
      p <- p0 +
      	geom_point(data = dfw,
      	  aes(x = longitude, y = latitude,
	      size = 20*log10(1+n),
	      color = highlight)) +
	      #color = highlight), alpha = 0.8) +	      
	  ggtitle(i) +
	  scale_size(range = c(2, 15)) +
	  theme(title = element_text(size = 30)) +
	  scale_color_manual(values = c("black", "red"))	  
    }
    
  pics[[as.character(i)]] <- p

}

library(gridExtra)
grid.arrange(pics[[1]], nrow = 1)
```


---

[General trends & political events]

### Publishing activity over time

- 1700-1721 Fennica drop
- 1760-1770s Kungliga peak 
- 1803-1815 Napoleonic wars

```{r publishingovertime, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4, out.width="200px"}
library(magrittr)
library(ggplot2)
library(dplyr)
df2 <- df0 %>% group_by(publication_decade, catalog) %>%
               summarise(n = n())
df2$highlight <- rep(FALSE, nrow(df2))
df2$highlight[df2$catalog == "Kungliga" &
	      df2$publication_decade %in% c(1770, 1810)] <- TRUE
df2$highlight[df2$catalog == "Fennica" &
	      df2$publication_decade %in% c(1710, 1810)] <- TRUE
v <- seq(1500, 1800, 50)
theme_set(theme_bw(20))
p <- ggplot(df2, aes(x = publication_decade, y = n)) +
     geom_line(aes(color = catalog), size = 1) +
     geom_point(aes(shape = catalog, color = highlight, size = highlight)) +
     ylab("Title count (n)") + xlab("Publication year") +
     #theme(legend.position = "none") +
     scale_x_continuous(breaks = v, labels = v) +
     scale_color_manual(values = c("black", "blue", "darkgreen", "blue")) + 
     guides(fill = guide_legend(reverse = TRUE)) 
print(p)
```


---

[General trends & political events]

### Swedish 1760-1770 publishing peak

Pamphleteering plays a crucial role during abolished censorship


```{r pamflets1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=4, out.width="280px", fig.show="hold"}
df <- df0 %>%
        filter(catalog == "Kungliga")

# Add indicator of the publication period
df$period <- cut(df$publication_year,
           breaks = c(1757, 1766, 1775, 1783),
		 include.lowest = TRUE,
		 right = FALSE
		 )

# Remove entries outside the investigated publication periods
df <- df %>% filter(!is.na(period)) %>%
	     group_by(period) %>%
	     summarise(n = n(),
		  paper = sum(paper.consumption.km2, na.rm = TRUE)) %>%
        mutate(paper.per.title = paper/n)		 

p <- ggplot(df,
       aes(x = period, y = paper.per.title)) + 
       geom_bar(stat = "identity") +
       scale_x_discrete(labels = c("1757-1765", "1766-1774", "1775-1783")) +
       ylab("Paper per title") + xlab("") 
print(p)
```

---

[General trends & political events]

### Swedish knowledge production & cycles of representation

An example how historical events, namely parliamentary assemblies in the Swedish case, have an effect on knowledge production.

```{r riksdar5, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=5}

minyear <- 1700
  maxyear <- 1800
  catalog <- "Kungliga"

library(magrittr)
library(ggplot2)
library(dplyr)
library(ggplot2)
library(reshape2)

#for (catal in as.character(unique(df0$catalog))) {

for (catal in "Kungliga") {

  # Use timeinterval year intervals
  dfsel = subset(df0, catalog == catal)

  df <- df0
  df = subset(df, catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year <= maxyear)
  
  df <- subset(dfsel, publication_year >= 1700 & publication_year < 1800 )

  timeinterval <- 1
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))
  ymin = min(dfm$Documents)
  ymax = max(dfm$Documents)

  rect_left <- c(min(na.omit(dfm$date)),
               1719-.5, 1719+.5, # Stockholm 20 januari 1719 1 juni 1719
               1734-.5, 1734+.5, # Stockholm 14 maj 1734 14 december 1734
               1765-.5, 1766+.5, # Stockholm 21 februari 1765 21 oktober 1766
               1769-.5, 1770+.5, # Norrköping & Stockholm 22 april 1769 5 februari 1770
               1771-.5, 1772+.5, # Stockholm 19 juni 1771 12 september 1772
               1792-.5, 1792+.5, # Gävle 26 januari 1792 24 februari 1792         
               max(na.omit(dfm$date)))
  rectangles <- data.frame(
    xmin = rect_left[-length(rect_left)],
    xmax = rect_left[-1],
    ymin = ymin,
    ymax = ymax
    )
  rectangles$shade <- rep(c("White", "Highlight"), length = nrow(rectangles))

 riksplace = c("Stockholm", "Stockholm", "Stockholm", "Norrköping", "Stockholm", "Gävle")
 cols = c("gray", "lightblue", "yellow", "white")
 rectangles$shade[rectangles$shade == "Highlight"] = riksplace
 rectangles$shade = factor(rectangles$shade)

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot()
  p <- p + geom_rect(data = rectangles, 
       aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax, fill=shade), alpha=0.8) + 
         scale_fill_manual(values = cols) # + guides(fill = "none") 
  p <- p + geom_line(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + geom_point(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + scale_x_continuous(breaks=seq(min(dfm$date), max(dfm$date), 20))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(catal)
  print(p)
}

```

---

**2. Publishers in Sweden and Turku**

---

[Publishers in Sweden and Turku]

### Publishers in Swedish University towns (and Finland)

```{r publishers2-finland, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=15}
df <- df0
df <- df %>%
        filter(catalog == "Fennica") %>%
	filter(country == "Finland" | publication_place == "Vyborg") %>%
        filter(publication_year >= 1640 & publication_year <= 1828)

# Top publication places
library(bibliographica)

top <- c("Turku", "Vaasa", "Vyborg")
df <- df %>%	
        filter(publication_place %in% top) %>%	
        select(publication_decade, publication_place, publisher)
	
npub <- unique(df) %>% group_by(publication_decade, publication_place) %>% tally()
npub$publication_place <- factor(npub$publication_place, levels = top)
npub.fennica <- npub


df <- df0
catalogue <- "Kungliga"
df <- df %>%
        filter(catalog == catalogue) %>%
        filter(publication_year >= 1640 & publication_year <= 1828)

# Selected publication places
top <- c("Stockholm", "Lund", "Uppsala", "Greifswald", "Tartu")
df <- df %>%	
        filter(publication_place %in% top) %>%	
        select(publication_decade, publication_place, publisher)
	
npub <- unique(df) %>% group_by(publication_decade, publication_place) %>% tally()
npub$publication_place <- factor(npub$publication_place, levels = top)
npub.kungliga <- npub

npub <- bind_rows(npub.fennica, npub.kungliga)

# Order by total publishing activity
npub$publication_place <- factor(npub$publication_place, levels = (npub %>% group_by(publication_place) %>% summarise(total = sum(n)) %>% arrange(desc(total)))$publication_place)
npub <- npub %>% arrange(publication_place)


theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = n)) +
       geom_bar(stat = "identity", position = "stack",
       		    aes(fill = publication_place)) + 
       xlab("Publication year") +
       ylab("Unique publishers (n)") +        
       guides(fill = guide_legend(reverse = TRUE, title = "")) #+ 
       #ggtitle(paste("Unique publishers in selected publication places (", catalogue, ")"))


print(p)
```


---

[Publishers in Sweden and Turku]

### Turku in Sweden: proportions for title count and paper in Swedish University towns
 
```{r comparisons, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=18, fig.height=10}
pics <- list()
for (catalogue in na.omit(unique(df0$catalog))) {

df <- df0 %>% filter(catalog == catalogue)%>%
        filter(publication_year >= 1640 & publication_year <= 1828)
places <- c("Stockholm", "Uppsala", "Lund", "Greifswald", "Turku")
df$publication_place[!df$publication_place %in% places] <- "Other"
df <- subset(df, !is.na(df$publication_place))
#df$publication_place <- factor(df$publication_place, levels = c(places, "Other"))
library(reshape2)
library(magrittr)
library(tidyr)

df <- df %>% group_by(publication_decade, publication_place) %>%
             summarise(n = n(),
       	       paper = sum(paper.consumption.km2, na.rm = TRUE),
		       publishers = length(na.omit(unique(publisher)))
		       )


# Calculate percentages
for (varname in c("n", "paper", "publishers")) {

  df$varname <- df[[varname]]
  dff <- df %>% select(publication_decade, publication_place, varname)
  dff <- spread(dff, publication_place, varname, fill = 0)
  dff[, -1] <- 100 * t(apply(dff[, -1], 1, function (x) {x/sum(x)}))
  dff <- melt(dff, "publication_decade");
  colnames(dff) <- c("publication_decade", "publication_place", "f")

  theme_set(theme_bw(20))
  p <- ggplot(dff, aes(x = publication_decade, y = f)) +
     geom_bar(position = "stack", stat = "identity",
       aes(fill = publication_place)) + 
     xlab("Publication year") +
     scale_fill_brewer(palette="Paired")
     if (varname == "n") {
       p <- p + ggtitle(paste("Title count (", catalogue, ")", sep = "")) + 
                ylab("Title count frequency (%)") 
     }
     if (varname == "paper") {
       p <- p + ggtitle(paste("Paper (", catalogue, ")", sep = "")) +
                ylab("Paper (%)")        
     }
     if (varname == "publishers") {
       p <- p + ggtitle(paste("Publishers (", catalogue, ")", sep = "")) +
                       ylab("Publishers (%)")
     }     
  p <- p + guides(fill = guide_legend(reverse = TRUE, title = "")) 

  pics[[paste(catalogue, varname, sep = "-")]] <- p

}
}
library(gridExtra)
grid.arrange(pics[[1]], pics[[2]], pics[[4]], pics[[5]], nrow = 2)
rm(pics)
```


---


[Publishers in Sweden and Turku]

### Top publishers in Turku/Fennica (title count)

```{r publishers4-fennica, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=15}
place <- "Turku"
catalogue = "Fennica"
df = df0

df <- df %>%
        filter(catalog == catalogue & publication_place == place)

df <- df %>%	
  filter(publication_year >= 1640 & publication_year <= 1828)%>%
        select(publication_decade, publisher, paper.consumption.km2)

# Group small publishers
# Top publishers by title count
ntop <- 10
top <- names(top(df, "publisher", ntop))
df$publisher[!df$publisher %in% top] <- "Other"
df$publisher <- factor(df$publisher, c(top, "Other"))

# Title count per decade & publisher	
npub <- df %>% group_by(publication_decade, publisher) %>% tally()

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = n)) +
       geom_bar(stat = "identity", position = "stack", aes(fill = publisher)) + 
       xlab("Publication year") +
       ylab("Title count (n)") #+        
       #ggtitle(paste("Title count per publisher (", place, "/", catalogue, ")", sep = ""))
print(p)
```

---

**3. Languages & religious texts in Finland**

---

[Languages & religious texts in Finland]

### Different languages in Turku, Stockholm, Lund and Uppsala

```{r language-perc2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=20, fig.height=12}
pics <- list()
theme_set(theme_bw(20))
myplaces <- c("Turku", "Greifswald", "Stockholm", "Uppsala", "Lund")

for (catalogue in c("Fennica", "Kungliga")) {

  df <- df0 %>% filter(catalog == catalogue) %>%
        filter(publication_year >= 1600 & publication_year <= 1828)

  langs <- c("Finnish", "Swedish", "Latin", "German",
           "Russian", "French", "Hebrew", "Other")

  lang <- paste("language.", langs, sep = "")
  otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
  df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0

  dfl <- NULL
  for (lan in lang) {

    # Classify a document to the specifed language
    # If document is assigned with languages, each case is considered
    # so one doc may have multiple entries corresponding to different languages
    # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
    # Combine data frames for specified languages
    dflsub <- filter(df, df[[lan]])
    if (nrow(dflsub) > 0) {
      dflsub$language <- gsub("language.", "", lan)
      dfl <- bind_rows(dfl, dflsub)
    }
  }

  df <- dfl %>% group_by(publication_decade, publication_place, language) %>%
     	     summarise(n = n())

  # Calculate percentages
  dff <- spread(df, language, n, fill = 0)
  dff[, -c(1,2)] <- 100 * t(apply(dff[, -c(1,2)], 1, function (x) {x/sum(x)}))

  dff <- melt(dff, id = c("publication_place", "publication_decade"))
  colnames(dff) <- c("publication_place", "publication_decade", "language", "f")

  for (myplace in myplaces) {
    p <- ggplot(subset(dff, publication_place == myplace), aes(x = publication_decade, y = f)) +
      geom_bar(position = "stack", stat = "identity", aes(fill = language)) + 
      xlab("Publication year") +
      ylab("Title count frequency (%)") +
      #ggtitle(paste("Languages (", myplace, "/", catalogue, ")", sep = "")) +
      ggtitle(paste(myplace, "/", catalogue)) +
      scale_fill_brewer(palette="Paired") + 
      guides(fill = guide_legend(reverse = TRUE, title = ""))
    pics[[paste(catalogue, myplace, sep = "-")]] <- p
  }
}

grid.arrange(pics[[1]],
             pics[[8]], pics[[9]], pics[[10]], 
             nrow = 2)

rm(pics)
```

---

[Languages & religious texts in Finland]

### Topic richness per language (Finnish publications)


```{r topics232, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, fig.show="hold"}
catalogue <- "Fennica"
df <- filter(df0, catalog == "Fennica") %>%
  filter(publication_year >= 1640 & publication_year <= 1828) %>%
  select(publication_year, language, subject_topic)
df <- unique(df)
df <- df %>% group_by(publication_year, language) %>%
             summarise(n = length(unique(unlist(strsplit(subject_topic, ";")))))

langs2 <- c("Finnish", "Swedish", "Latin", "Other")
df$language[!df$language %in% langs2] <- "Other"
df$language <- factor(df$language, levels = langs2)

p <- ggplot(df, aes(x = publication_year, y = n, color = language)) +
       geom_line() + geom_point() 

print(p)
```

---

[Languages & religious texts in Finland]

### Devotional literature (catechisms, hymns, prayer collections, etc.) 

Form of literature denoting the advancement of reading in Finland in the nineteenth century. It has been unclear when does it show up as a relevant category.

```{r topics12122, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, fig.show="hold"}
sel <- c("virret","arkkiveisut","hartauskirjat","katekismukset","rukouspäivät","saarnat","aapiset","rukoukset","rukous","hengelliset laulut","hartauspuheet","virsikirjat")
catalogue <- "Fennica"

  # Selected catalogue with selected years
  df <- filter(df0, catalog == catalogue &
     		    publication_year >= 1640 &
		    publication_year <= 1828)

  # Selected topics
  df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  
  df <- df %>% filter(catalog == catalogue & hit)

  lang <- paste("language.", langs, sep = "")
  otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
  df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0
  dfl <- NULL
  for (lan in lang) {
    # Classify a document to the specifed language
    # If document is assigned with languages, each case is considered
    # so one doc may have multiple entries corresponding to different languages
    # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
    # Combine data frames for specified languages
    dflsub <- filter(df, df[[lan]])
    if (nrow(dflsub) > 0) {
      dflsub$language <- gsub("language.", "", lan)
      dfl <- bind_rows(dfl, dflsub)
    }
  }
  df <- dfl %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

  # PAPER CONSUMPTION
  theme_set(theme_bw(20))
  p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       xlab("Publication year") +
       ylab("Paper consumption") +
       ggtitle(catalogue) 
       #ggtitle(paste("Languages (", catalogue, ")", sep = "")) 
  print(p)
```

---

[Languages & religious texts in Finland]

### Temporary sermons in Latin and Swedish

- play an important role in early modern knowledge production. It has not been analysed in what language they were in Finland (and Sweden). 

```{r topics882, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6}
  sel <- c("hautajaiset", "häät", "juhlamenot")
  catalogue <- "Fennica"
  df <- df0
  df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  

  # Selected catalogue with selected topics
  df <- df %>% filter(catalog == catalogue & hit)
  lang <- paste("language.", langs, sep = "")
  otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
  df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0

  dfl <- NULL
  for (lan in lang) {
    # Classify a document to the specifed language
    # If document is assigned with languages, each case is considered
    # so one doc may have multiple entries corresponding to different languages
    # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
    # Combine data frames for specified languages
    dflsub <- filter(df, df[[lan]])
    if (nrow(dflsub) > 0) {
      dflsub$language <- gsub("language.", "", lan)
    dfl <- bind_rows(dfl, dflsub)
  }
}
dfl$language <- factor(dfl$language, levels = langs)

  df <- dfl %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

  # PAPER CONSUMPTION
  p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       xlab("Publication year") +
       ylab("Paper consumption") +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
  print(p)
```

---

**4. University curriculum & Enlightenment in Finland**

---

[University curriculum & Enlightenment in Finland]

### Dissertation languages in Turku 1640-1828


```{r disslang, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6}
catalogue <- "Fennica"
langs <- c("Finnish", "Swedish", "Latin", "German",
           "Russian", "French", "Hebrew", "Other")

df <- df0 %>%
        filter(catalog == catalogue) %>%
        filter(publication_year >= 1640 & publication_year <= 1828) %>%
	filter(dissertation) 

lang <- paste("language.", langs, sep = "")
otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0

dfl <- NULL
for (lan in lang) {

  # Classify a document to the specifed language
  # If document is assigned with languages, each case is considered
  # so one doc may have multiple entries corresponding to different languages
  # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
  # Combine data frames for specified languages
  dflsub <- filter(df, df[[lan]])
  if (nrow(dflsub)>0) {
    dflsub$language <- gsub("language.", "", lan)
    dfl <- bind_rows(dfl, dflsub)
  }
}

df <- dfl %>% group_by(publication_decade, language) %>%
     	     summarise(n = n())

# Calculate percentages
dff <- spread(df, language, n, fill = 0)
dff[, -1] <- 100 * t(apply(dff[, -1], 1, function (x) {x/sum(x)}))
dff <- melt(dff, "publication_decade");
colnames(dff) <- c("publication_decade", "language", "f")

# Order by language counts
dff$language <- factor(dff$language,
   levels = (df %>% group_by(language) %>%
                    summarise(total = sum(n)) %>%
		    arrange(total))$language);
dff <- dff %>% arrange(desc(language))

theme_set(theme_bw(20))
p <- ggplot(dff, aes(x = publication_decade, y = f)) +
     geom_bar(position = "stack", stat = "identity", aes(fill = language)) + 
     xlab("Publication year") +
     ylab("Title count frequency (%)") +
     ggtitle(paste("Languages (", catalogue, ")", sep = "")) +
     scale_fill_brewer(palette="Paired")
print(p)
```

---

[University curriculum & Enlightenment in Finland]

### Printing of philosophy in different languages in Turku

```{r topics-103, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6}
sel = c("filosofia","luonnonfilosofia","metafysiikka","logiikka")
# Selected catalogue with selected topics
df = dfl
df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  
df <- df %>% filter(hit)
df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
                 paper = sum(paper.consumption.km2, na.rm = TRUE))

# PAPER CONSUMPTION
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_bar(aes(fill = language), position = "stack", stat = "identity") +                     
       xlab("Publication year") +
       ylab("Paper consumption") +
       guides(fill = guide_legend(reverse = TRUE, title = "")) 
       #ggtitle(paste("Paper (", paste(sel, collapse = ";"), ")", sep = ""))
print(p)

```


---

[University curriculum & Enlightenment in Finland]

### Printing of history in different languages in Turku

```{r topics-102, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6}
sel = c("oppihistoria","antiikki","historia")
# Selected catalogue with selected topics
df = dfl
df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  
df <- df %>% filter(hit)
df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

# PAPER CONSUMPTION
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_bar(aes(fill = language), position = "stack", stat = "identity") +             
       xlab("Publication year") +
       ylab("Paper consumption") +
       guides(fill = guide_legend(reverse = TRUE, title = "")) 
       #ggtitle(paste("Paper (", paste(sel, collapse = ";"), ")", sep = ""))
print(p)

```

---

[University curriculum & Enlightenment in Finland]

### Printing of economy and social science in different languages in Turku


```{r topics-105, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6}
sel =   c("psykologia","yhteiskuntafilosofia","valtiofilosofia","talous","raha","moraali","velvollisuudet","kasvatus","maanviljely","maatalous","kalastus")

# Selected catalogue with selected topics
df = dfl
df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  
df <- df %>% filter(hit)
df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

# PAPER CONSUMPTION
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_bar(aes(fill = language), position = "stack", stat = "identity") +              
       xlab("Publication year") +
       ylab("Paper consumption") +
       guides(fill = guide_legend(reverse = TRUE, title = "")) 
       #ggtitle(paste("Paper (", paste(sel, collapse = ";"), ")", sep = ""))
print(p)

```

---


[University curriculum & Enlightenment in Finland]

### Printing by topic in different languages in Turku

```{r topics-103B, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=9}
sel = c("filosofia","luonnonfilosofia","metafysiikka","logiikka")
df = dfl
df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  
df <- df %>% filter(hit)
df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
                 paper = sum(paper.consumption.km2, na.rm = TRUE))

# PAPER CONSUMPTION
p1 <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_bar(aes(fill = language), position = "stack", stat = "identity") +                     
       xlab("Publication year") +
       ylab("Paper consumption") +
       guides(fill = guide_legend(reverse = TRUE, title = "")) +
       ggtitle("Philosophy")


sel = c("oppihistoria","antiikki","historia")
# Selected catalogue with selected topics
df = dfl
df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  
df <- df %>% filter(hit)
df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

# PAPER CONSUMPTION
p2 <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_bar(aes(fill = language), position = "stack", stat = "identity") +             
       xlab("Publication year") +
       ylab("Paper consumption") +
       guides(fill = guide_legend(reverse = TRUE, title = "")) +
       ggtitle("History")


sel =   c("psykologia","yhteiskuntafilosofia","valtiofilosofia","talous","raha","moraali","velvollisuudet","kasvatus","maanviljely","maatalous","kalastus")

# Selected catalogue with selected topics
df = dfl
df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  
df <- df %>% filter(hit)
df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

# PAPER CONSUMPTION
theme_set(theme_bw(20))
p3 <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_bar(aes(fill = language), position = "stack", stat = "identity") +              
       xlab("Publication year") +
       ylab("Paper consumption") +
       guides(fill = guide_legend(reverse = TRUE, title = "")) +
       ggtitle("Economy")
grid.arrange(p1, p2, p3, nrow = 3)
```


---

[University curriculum & Enlightenment in Finland]

### Rise of the octavo sized book as vehicle of Enlightenment

Paper consumption for different document formats over time. 

```{r LIBER-13, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=11, fig.height=9, fig.show="hold", out.width="160px"}
for (catal in unique(df0$catalog)) {
  df2 <- subset(df0, catalog == catal) %>% group_by(publication_decade, gatherings) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
  df2 <- filter(df2, gatherings %in% setdiff(names(which(table(df2$gatherings) >= 15)), "NA"))
  df2$highlight <- rep("gray", nrow(df2))
  df2$highlight[df2$gatherings == "8vo"] <- "darkgreen"
    
  p <- ggplot(df2, aes(y = paper.consumption.km2,
                       x = publication_decade,
  	       shape = gatherings,
		       linetype = gatherings))		       
  p <- p + geom_point(size = 4)
  p <- p + geom_smooth(method = "loess", size = 1,
         aes(color = highlight, fill = highlight))
  p <- p + scale_color_manual(values = c("darkgreen", "darkgray"))
  p <- p + scale_fill_manual(values = c("darkgreen", "darkgray"))  	 
  p <- p + ggtitle("Paper consumption in time by gatherings")
  p <- p + xlab("Year")
  p <- p + ylab("Paper consumption (km2)")
  p <- p + guides(linetype = guide_legend(keywidth = 5),
       	          shape = guide_legend(keywidth = 5))
  p <- p + ggtitle(paste("Paper consumption\n(", catal, ")", sep = ""))
  print(p)
}
```

---

[University curriculum & Enlightenment in Finland]

### Enlightenment literature read in Finland

```{r authors22, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=10, out.width="160px", fig.show="hold"}
theme_set(theme_bw(20))
for (catalogue in c("Fennica", "Kungliga")) {
  df <- filter(df0, catalog == catalogue) %>%
        filter(publication_year >= 1640 & publication_year <= 1828)
  top.authors <- names(bibliographica::top(df, field = "author", n = 10))
  dfs <- df %>% filter(author %in% top.authors) %>%
         group_by(author, publication_decade) %>%
         tally() %>%
         arrange(publication_decade)
  p <- ggplot(dfs, aes(x = publication_decade, y = n, fill = author)) +
       geom_bar(stat = "identity", position = "stack", color = "black") +
       xlab("Publication Decade") +
       ylab("Title Count") +
       scale_fill_grey() +
       guides(fill = guide_legend("Author")) +
       ggtitle(paste("Title count top authors\n", catalogue)) +
       xlim(c(1640, 1828))
  print(p)
}
```

---

##Thanks !


R master (plots & maps):  
- Leo Lahti  


Institutional support:

- Academy of Finland
- University of Helsinki
- Digitalia / The Regional Council of South Savo

Data providers:

- National Library of Finland
- National Library of Sweden


For more info, see: \textcolor[blue]{https://github.com/rOpenGov/fennica}

---


### Duplicate publications in Fennica/Kungliga

```{r duplicates, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=5, fig.width=10}
df <- df.combined.preprocessed %>%
        filter(publication_year >= 1640 & publication_year <=1828) %>%
        group_by(catalog, publication_decade) %>%
	summarise(duplicates = 100 * mean(remove))
				   
p <- ggplot(df, aes(x = publication_decade, y = duplicates, fill = catalog)) +
       geom_bar(position = "dodge", stat = "identity") +
       ylab("Duplicates (%)") +
       scale_fill_manual(values = c("blue", "red")) 
       #ggtitle(paste("Certain duplicates Fennica-Kungliga", paste(range(na.omit(df$publication_decade)), collapse = "-"))) 

print(p)
```


