---
title: "Digital History in Finland, 1488-1828"
author: "Mikko Tolonen, Jani Marjanen, Hege Roivainen, Leo Lahti"
date: "`r Sys.Date()`"
bibliography: 
- bibliography.bib
- references.bib
output: 
  md_document:
    variant: markdown_github
---
<!--
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{microbiome tutorial}
  %\usepackage[utf8]{inputenc}
-->

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Handle citations
require(knitcitations)
cleanbib()
#options("citation_format" = "pandoc")
cite_options(hyperlink = TRUE, max.names = 3)
bib <- read.bibtex("bibliography.bib")
#opts_chunk$set(fig.width=4, fig.height=3, par=TRUE, out.width='2in', fig.pos='H')
knitr::opts_chunk$set(fig.path = "figure_201606_Krakow/", dev="CairoPNG")
#knitr::opts_chunk$set(fig.path = "figure_201606_Krakow/")
```

```{r 201606krakow-init, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
library(stringr)
library(dplyr)
library(ggplot2)
library(bibliographica)
library(fennica)
library(sorvi)

# Nice theme
theme_set(theme_bw(26))

# Define time span
min.year <- 1488
max.year <- 1828

# Read data
fen0 <- readRDS("df.Rds")
kun0 <- readRDS("../../../kungliga/df.Rds")

fenraw <- readRDS("df.raw.Rds")
kunraw <- readRDS("../../../kungliga/df.raw.Rds")

fen <- fen0 %>% filter(publication_year >= min.year & publication_year <= max.year)
kun <- kun0 %>% filter(publication_year >= min.year & publication_year <= max.year)

# Full time span
df.full = bind_rows(fen0, kun0)
df.full$catalog = factor(c(rep("Fennica", nrow(fen0)), rep("Kungliga", nrow(kun0))))

# Selected time spam
df0 = bind_rows(fen, kun)
df0$catalog = factor(c(rep("Fennica", nrow(fen)), rep("Kungliga", nrow(kun))))
```



Printing in a Periphery: a Quantitative Study of Finnish Knowledge Production, 1640-1828
==============

TODO-järjestyksestä:

Selvensin alle (Publisher analysis kohtaan):

  * PUBLISHER-TODO1
  * PUBLISHER-TODO2
  * Lisäksi löytyy muita ajatuksia.

Muiden osalta (voi tehdä jo ilman publisher kenttää), järjestys: **Book printing in Finland** - kohdasta

  * BOOKINFINLAND-TODO1
  * BOOKINFINLAND-TODO2

Marjanen ja minä siivotaan samalla näitä muita analyysi-ideoita toteuttamiskelpoisiksi ohjeiksi. Jani voi tehdä tätä omatoimisesti myös.

Lisäsin alle seuraavat TODO:t (Ovatko nämä toteuttamiskelpoisia?):  

  * TODO_Political events 1
  * TODO_Turku in Sweden 1
  * TODO_Turku in Sweden 2
  * TODO_Publisher analysis_
  * TODO_Publishing in Finland
  * TODO_Publishing in Finland_kieliolosuhteet_muualla



## Introduction 

Matti Klinge HYn historia; Jari Niemelä, Vain hyödynkö tähden
(väitöskirja) käsittelee Turun yliopiston asemaa.

Östholm, Hanna, Litteraturens uppodling : läsesällskap och litteraturkritik som politisk strategi vid sekelskiftet 1800; vertailee Turkua ja Uppsalaa lukuseurojen kautta. 

Grönroos, Henrik & Nyman, Ann-Charlotte, Boken i Finland, 1996.

Suomen taloushistoria, Historiallinen tilasto 3, 1983.

Vasenius, Valfrid, Suomalainen kirjallisuus, 1544-1877, 1878.

Gardberg, Carl-Rudolf, Kirjapainotaito Suomessa I-III, 1949-1973.

Heininen, Simo, Ulkomaisen kirjallisuuden tulo Suomeen 1531-1600. SKHSV, 1991.

Häkli, Esko, Näin syntyi ja säilyi suomalainen kirja, 1989.

Laine, Tuija, Vanhimman suomalaisen kirjallisuuden käsikirja, 1997.

Vieraskielinen kirjallisuus Suomessa Ruotsin vallan aikana.

Wittman, Reinhard, Was there a reading revolution at the end of the eighteenth century? A history of reading in the west. Cambridge, 2003.

Aatehistoria ja digitaalisten aineistojen mahdollisuudet `r citep(bib[["Tolonen15EnnenNyt"]])` 

We have prepared open data analytical ecosystem for in-depth analysis
of such data collections `r citep("10.18352/lq.10112")`.

You can cite with the DOI (the citation info will then be collected automatically): `r citep("10.18352/lq.10112")` or alternatively add new references to the [bib
file](bibliography.bib) and then cite using the key with
`r citep(bib[["Lahti15LIBER"]])`. Such citations will be automatically
numbered and collected in references section.

- Knowledge production has been approached largely through a national perspective, here we shift focus by combining materials from Sweden and Finland and by specifically looking at cities as sites for knowledge production. Cities are to this effect seen as partly supplementing, partly competing intellectual centres.



## Results

MT: We are in a session called "MAPS and SPACE", so I think we need to have some of the results presented on a map. Now, the question is what is possible to do within this time? But perhaps the publishing houses should be included in this? LL: yes we can rather easily add map visualization when it is clear what we like to present using maps. For instance the code we used for LIBER to visualize differences in publishing activity across UK can be reused (with different regions), also videos can be made for presentation if we like. But I would first focus on findings, and polish the visualizations later. I will try to look at maps somewhere this week. The less there are other todo points, the more there will be time for maps. If you like to see some result specifically on a map, please mark it so and I can check.


Why Fennica has huge drop in 1700s? Do some publisher disappear (see
below for an answer..)


Let us look at top publication places during the period 1650-1750 in Fennica: 

```{r drop1700, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=6, out.width="280px"}

  catal = "Fennica"
  minyear = 1650
  maxyear = 1750
  df = subset(df0, catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year < maxyear)
  mydf = df

selected.places = names(top(mydf, "publication_place", 6))

for (myplace in selected.places) {

  df = subset(mydf, publication_place == myplace)

  # Use timeinterval year intervals
  timeinterval <- 5
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot(data = dfm, aes(x = date, y = Documents))
  p <- p + geom_line(col = "black")
  #p <- p + geom_smooth(col = "black")  
  p <- p + geom_point(col = "black", size = 3)
  p <- p + scale_x_continuous(breaks = seq(minyear, maxyear, 20), limits = c(minyear, maxyear))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + scale_y_continuous(limits = c(0, 100))  
  p <- p + ggtitle(paste(myplace, " (", catal, ")", sep = ""))
  
  print(p)
}
```

The drop in Fennica is explained largely by Great Nortern War (1700-1721). The war and difficult times seems to hit Turku particularly hard in early eighteenth century. What is telling also is that the curve of overall publishing activity in Kungliga is much steeper in eighteenth century compared to Fennica also in the second half of the century. This is the Enlightenment’s rising trend of knowledge production in most of Europe (for example ESTC has a similar development with Kungliga). Thus, development of publishing in Finland is much slower compared to larger European centers in the eighteenth century – this is an important context for the even further difficulties that follow after 1828.


The following figure highlights publisher title count changes around 1700 drop in Turku, the most significant publishing place at the time:

```{r drop1700B, echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=7}
catalogue <- "Fennica"
place <- "Turku"

df <- df0
df <- df %>%
        filter(catalog == catalogue & publication_place == place) %>%
        filter(publication_year >= 1650 & publication_year < 1750)

# Selected ones
top <- names(top(df, "publisher", 5))
df$publisher[!df$publisher %in% top] <- "Other"
df$publisher <- factor(df$publisher, levels = c(top, "Other"))

# Publishing per year & publisher	
npub <- df %>%
     	  group_by(publication_year, publisher) %>%
	  summarize(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n())

theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_year, y = n, group = publisher)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(size = 5, aes(shape = publisher, color = publisher)) +
       #geom_line(col = "black", aes(shape = publisher)) +       
       geom_smooth(col = "black", aes(shape = publisher, fill = publisher, color = publisher)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       ylim(c(0, 1.1*max(npub$n))) +
       ggtitle(paste("Title count (", place, "/", catalogue, ")", sep = ""))
print(p)
```


Here the same for the complete Fennica:

```{r summaryTop10pubtimeline, fig.height=10, fig.width=20, echo=FALSE}
df <- filter(df0, catalog == "Fennica")
theme_set(theme_bw(20))
tops <- names(top(df, field = "publisher", n = 5))
field <- "publisher"
dfs <- df
dfs$field <- dfs[[field]]
dfs <- dfs %>% filter(field %in% tops) %>%
     	 group_by(field, publication_decade) %>%
     	 tally() %>%
     	 arrange(publication_decade)
p <- ggplot(dfs, aes(x = publication_decade, y = n, fill = field)) +
       geom_bar(stat = "identity", position = "stack", color = "black") +
       xlab("Publication Decade") +
       ylab("Title Count") +
       scale_fill_grey() +
       guides(fill = guide_legend("field")) +
       ggtitle("Title count timeline for the top publishers in Fennica")
print(p)
```


TODO: try check duplicates. Clustering with identical place, identical year, near identical title and then print table with potential duplicates for manual checks. - LL: you mean something different from what HR already did ? Duplicates within Fennica, or duplicates between Fennica vs Kungliga ? To be removed from all analyses, or a specific figure ?


Paper per title count ratio per publisher. [nähdään voidaanko sanoa onko joku selkeästi asetusten julkaisija ja toisella myös kirjoja (tai asetuskokoelmia).]

```{r publisherpapertitle, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
for (catalogue in c("Fennica", "Kungliga")) {

df <- df0
df <- df %>%
        filter(catalog == catalogue) %>%
	filter(publication_year >= 1640 & publication_year <= 1828)

# Selected ones
top <- names(top(df, "publisher", 5))
df$publisher[!df$publisher %in% top] <- "Other"
df$publisher <- factor(df$publisher, levels = c(top, "Other"))

# Publishing per decade & publisher	
npub <- df %>%
     	  group_by(publication_decade, publisher) %>%
	  summarize(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n()) %>%
	  mutate(paper.per.title = paper/n)


theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = paper.per.title, group = publisher)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(size = 5, aes(shape = publisher, color = publisher)) +
       #geom_line(col = "black", aes(shape = publisher)) +       
       geom_smooth(col = "black", aes(shape = publisher, fill = publisher, color = publisher)) + 
       xlab("Publication year") +
       ylab("Paper per title") +
       ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Paper per title ratio (", catalogue, ")", sep = ""))
print(p)
}
```



### General trends: Fennica vs. Kungliga

  * [Fennica overview](https://github.com/rOpenGov/fennica/blob/master/inst/examples/overview.md)
  * [Kungliga overview](https://github.com/rOpenGov/kungliga/blob/master/antagomir/overview.md)  

Top-author timelines. Putsaus ok (näistä tsekattu, että ei löydy ainakaan isoa määrää laskuista puuttuvia nimivariantilla julkaistuja teoksia). Kungligassa väitöskirjat näyttelevät huomattavasti pienempää osaa kuin Fennicassa. Näkyy näistä top-auktori kuvista.
 
```{r summaryTop10authorstimeline, fig.height=4, fig.width=10, echo=FALSE, fig.show="hold", out.width="430px"}
theme_set(theme_bw(20))
for (catalogue in c("Fennica", "Kungliga")) {
  df <- filter(df0, catalog == catalogue)
  top.authors <- names(top(df, field = "author", n = 3))
  dfs <- df %>% filter(author %in% top.authors) %>%
     	 group_by(author, publication_decade) %>%
     	 tally() %>%
     	 arrange(publication_decade)
  p <- ggplot(dfs, aes(x = publication_decade, y = n, fill = author)) +
       geom_bar(stat = "identity", position = "stack", color = "black") +
       xlab("Publication Decade") +
       ylab("Title Count") +
       scale_fill_grey() +
       guides(fill = guide_legend("Author")) +
       ggtitle(paste("Title count top authors\n", catalogue)) +
       xlim(range(df0$publication_year))
  print(p)
}
```


Fennica yhteenvedoissa on EDITIONS kohta. Kuvia mahdollista saada? On nimittäin mielenkiintoinen kysymys. LL: ok lisasin tan sinne - voin elaboroida lisaa jos on ehdotuksia:

MT: otetaan tarkasteluun ainoastaan sellaiset julkaisut joista on enemmän kuin yksi editio. Eli editioita pitää olla kaksi tai useampi, että lasketaan mukaan. Näistä sitten tarkastellaan ainoastaan sen ensimmäisen edition ilmestymistä. Lisäksi voisi piirtää toisen kuvan jossa tarkastellaan muita kuin sen ensimmäisen edition ilmestymistä (eli toinen, kolmas jne. editiot). LL: tää lienee TODO-listan häntäpäässä? Tuntuu vähemmän tärkeältä kuin muut eli skippaan for now.

```{r firsteditions, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=6, out.width="430px", fig.show="hold"}
for (catalogue in c("Fennica", "Kungliga")) {
df <- df0
df <- df %>%
        filter(catalog == catalogue) %>%
	filter(publication_year >= 1640 & publication_year <= 1828)

df <- df %>% group_by(publication_decade) %>%
             summarise(n = sum(first_edition, na.rm = TRUE))
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n)) +
       geom_point(size = 5) +
       geom_smooth(col = "black") + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       ggtitle(paste("First editions per decade (", catalogue, ")", sep = ""))
print(p)
}
```


Overall development in publishing activity:

```{r publishingovertime, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=10, out.width="430px"}
df2 <- df0 %>% group_by(publication_decade, catalog) %>% summarise(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n())
df2$catalog = factor(df2$catalog, levels = rev(c("Fennica", "Kungliga")))
p <- ggplot(df2, aes(x = publication_decade, y = n)) +
     #geom_bar(stat = "identity") + #scale_y_log10() +
     geom_line(aes(linetype = catalog)) +
     geom_point(aes(shape = catalog), size = 3) +     
     #ylab("Paper consumption (km2)")
     ylab("Title count (n)") + xlab("Publication year") +  
     ggtitle("Overall publishing activity")
print(p)
```


The top publication places ranked by the title count

```{r LIBER-topplace, echo=FALSE, message=FALSE, cache=FALSE, fig.height=6, fig.width=12}
theme_set(theme_bw(20))
ntop = 10
p <- top_plot(fen, "publication_place", ntop = ntop)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title count (Log10 scale)")
p <- p + scale_y_log10()
p <- p + ggtitle("Top publication places\n(Fennica)")
pf = p

theme_set(theme_bw(30))
p <- top_plot(kun, "publication_place", ntop = ntop)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title count (Log10 scale)")
p <- p + scale_y_log10()
p <- p + ggtitle("Top publication places\n(Kungliga)")
pk = p

grid.arrange(pf, pk, nrow = 1)
```


Comparison of printing activity in Turku, Uppsala, Lund, and
Stockholm. Turussa julkaiseminen alkaa vasta 1640-luvulla, mutta
ollaan kiinnostuttu ruotsalaisesta julkaisemisesta ennen sitä. Esim
miten Turun yliopiston perustaminen vaikuttaa ruotsalaiseen
julkaisukenttään 1600-luvun aikana.


```{r publishingactivitycomparisons, echo=FALSE, message=FALSE, cache=FALSE, fig.width=8, fig.height=6, fig.show="hold", out.width="430px"}
selected.places = c("Turku", "Uppsala", "Lund", "Stockholm")
df2 <- df0 %>% group_by(publication_decade, publication_place, catalog) %>%
               summarise(n = n()) %>%
               #summarise(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n()) %>%	       
	       filter(publication_place %in% selected.places) # %>%
	       #filter(publication_decade >= 1600)
df2$catalog = factor(df2$catalog, levels = rev(c("Fennica", "Kungliga")))
df2$publication_place = droplevels(factor(df2$publication_place))
df3 = spread(df2, publication_decade, n, fill = 0)
df2 = melt(df3)
colnames(df2) = c("publication_place", "catalog", "publication_decade", "n")
df2$publication_decade = as.numeric(as.character(df2$publication_decade))
df2$n = as.numeric(as.character(df2$n))
for (catal in unique(df2$catalog)) {

  p <- ggplot(subset(df2, catalog == catal), aes(x = publication_decade, y = n)) +
     geom_line(aes(linetype = publication_place)) +
     geom_point(aes(shape = publication_place), size = 3) +
     #scale_y_log10() +
     #facet_wrap(catalog ~ .) + 
     ylab("Title count (n)") + xlab("Publication year") +  
     ggtitle(catal)
  print(p)

}
```


### Effects of historical events 

**Riksdagar** are in some cases associated with publishing peaks (see
Figure ...). See "Vapauden ajan valtiopäivät" from 1719 onwards ?

In particular: Riksdag Stockholm 20 januari 1719 1 juni 1719; Stockholm 14 maj 1734 14 december 1734; Stockholm 21 februari 1765 21 oktober 1766; Norrköping & Stockholm 22 april 1769 5 februari 1770; Stockholm 19 juni 1771 12 september 1772; Gävle 26 januari 1792 24 februari 1792.

The publishing of historical works in .. on a timeline highlighting the eras of the riksdagar (16..-16..).. 

**Painovapaus**, 1766, räjähtääkö / kasvaako julkaiseminen merkittävästi
ja miten tämä näkyy Tukholma vs. muu valtakunta (ml. Turku)?
Painovapaus on 1766-1772, miten tämä näkyy ?


```{r riksdar1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6, fig.show="hold", out.width="430px"}
for (catal in as.character(unique(df0$catalog))) {

  # Use timeinterval year intervals
  dfsel = subset(df0, catalog == catal)
  #dfsel = subset(df0, publication_place == "Stockholm")
  #dfsel = subset(df0, publication_place == "Norrköping")
  #dfsel = subset(df0, publication_place == "Gävle")

  df <- subset(dfsel, publication_year >= 1700 & publication_year < 1800 )

  timeinterval <- 1
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))
  ymin = min(dfm$Documents)
  ymax = max(dfm$Documents)

  rect_left <- c(min(na.omit(dfm$date)),
               1719-.5, 1719+.5, # Stockholm 20 januari 1719 1 juni 1719
               1734-.5, 1734+.5, # Stockholm 14 maj 1734 14 december 1734
               1765-.5, 1766+.5, # Stockholm 21 februari 1765 21 oktober 1766
               1769-.5, 1770+.5, # Norrköping & Stockholm 22 april 1769 5 februari 1770
               1771-.5, 1772+.5, # Stockholm 19 juni 1771 12 september 1772
               1792-.5, 1792+.5, # Gävle 26 januari 1792 24 februari 1792	       
               max(na.omit(dfm$date)))
  rectangles <- data.frame(
    xmin = rect_left[-length(rect_left)],
    xmax = rect_left[-1],
    ymin = ymin,
    ymax = ymax
    )
  rectangles$shade <- rep(c("White", "Highlight"), length = nrow(rectangles))

 riksplace = c("Stockholm", "Stockholm", "Stockholm", "Norrköping", "Stockholm", "Gävle")
 cols = c("gray", "lightblue", "yellow", "white")
 rectangles$shade[rectangles$shade == "Highlight"] = riksplace
 rectangles$shade = factor(rectangles$shade)

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot()
  p <- p + geom_rect(data = rectangles, 
	   aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax, fill=shade), alpha=0.8) + 
         scale_fill_manual(values = cols) # + guides(fill = "none") 
  p <- p + geom_line(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + geom_point(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + scale_x_continuous(breaks=seq(min(dfm$date), max(dfm$date), 20))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(catal)
  print(p)
}
```


Focus on Gävle (gray) during riksdagar. Gävle has `r sum("Gävle" %in% fen$publication_place)` occurrences in Fennica, hence not included here. The figure on Gävle is based on Kungliga.

```{r riksdar2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=7, out.width="430px"}

  # Use timeinterval year intervals
  myplace = "Gävle" # Norrköping / Stockholm
  minyear = 1700
  maxyear = 1800
  catal = "Kungliga"

  df = subset(df0, publication_place == myplace & catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year < maxyear)

  timeinterval <- 1
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))
  ymin = min(dfm$Documents)
  ymax = max(dfm$Documents)

  rect_left <- c(min(na.omit(dfm$date)),
               1719-.5, 1719+.5, # Stockholm 20 januari 1719 1 juni 1719
               1734-.5, 1734+.5, # Stockholm 14 maj 1734 14 december 1734
               1765-.5, 1766+.5, # Stockholm 21 februari 1765 21 oktober 1766
               1769-.5, 1770+.5, # Norrköping & Stockholm 22 april 1769 5 februari 1770
               1771-.5, 1772+.5, # Stockholm 19 juni 1771 12 september 1772
               1792-.5, 1792+.5, # Gävle 26 januari 1792 24 februari 1792	       
               max(na.omit(dfm$date)))
  rectangles <- data.frame(
    xmin = rect_left[-length(rect_left)],
    xmax = rect_left[-1],
    ymin = ymin,
    ymax = ymax
    )
  rectangles$shade <- rep(c("White", "Highlight"), length = nrow(rectangles))

 riksplace = c("Stockholm", "Stockholm", "Stockholm", "Norrköping", "Stockholm", "Gävle")
 cols = c("gray", "lightblue", "yellow", "white")
 rectangles$shade[rectangles$shade == "Highlight"] = riksplace
 rectangles$shade = factor(rectangles$shade)

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot()
  p <- p + geom_rect(data = rectangles, 
	   aes(xmin=xmin, xmax=xmax,
	       ymin=ymin, ymax=ymax,
	       fill=shade), alpha=0.8) + 
         scale_fill_manual(values = cols) # + guides(fill = "none") 
  p <- p + geom_line(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + geom_point(data = dfm, aes(x = date, y = Documents), col = "black")
  p <- p + scale_x_continuous(breaks = seq(minyear, maxyear, 20))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(paste(myplace, " (", catal, ")", sep = ""))
  print(p)
```


**DONE_Political events 1** Kaaviot Tukholmasta, Uppsalasta, Lundista, Greifswaldista ja Turusta ajalle 1760-1780, joissa näkyy vuosittain julkaisumäärät, arvio paperinkulutuksesta ja kustantajien määrästä. Nämä pitää tehdä erikseen Fennicasta ja Kungligasta, eli yhteensä kuusi kaaviota. Tärkeää, että saadaan jokaisesta vuodesta oma piste/luku. Trendiviiva ei ole kovinkaan kiinnostava, koska tässä yritetään selvittää sitä millä tavalla painovapausaika (1766-1774) erottuu materiaalissa. Yksi aikaisemman tutkimuksen väitteistä on se, että pamflettikirjoittelu räjähtää tänä aikana. Tätä testataan vertaamalla paperinkulutusta ja nimikkeiden määrää. Julkaisijoiden määrän kasvu näkyy Kungligan materiaalissa Tukholman osalta ja Turunkin osalta päästään kymmeneen julkaisijaan joten verrataan tätä muihin kaupunkeihin. Synnyttääkö painovapaus uusia julkaisijoita (vastaus on kyllä)? 


```{r polev1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="280px", fig.show="hold"}
# TITLE COUNT
sel.places = c("Stockholm", "Uppsala", "Lund", "Greifswald", "Turku")
sel.years = c(1760, 1780)

for (place in sel.places) {


for (catalogue in c("Fennica", "Kungliga")) {

  df <- df0
  dfs <- df %>% filter(catalog == catalogue &
     	              publication_place == place &
		      publication_year >= min(sel.years) &
		      publication_year <= max(sel.years) 
		      )

  df <- dfs %>% group_by(publication_year) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))



  # TITLE COUNT
  theme_set(theme_bw(20))
  p <- ggplot(df, aes(x = publication_year, y = n)) +
       geom_point(size = 5) +
       geom_line() +       
       # geom_smooth() + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       ggtitle(paste("Title count:", catalogue, place))
  print(p)


  # PAPER CONSUMPTION
  theme_set(theme_bw(20))
  p <- ggplot(df, aes(x = publication_year, y = paper)) +
       geom_point(size = 5) +
       geom_line() +       
       # geom_smooth() + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Paper:", catalogue, place))
  print(p)

  # PUBLISHER COUNT
  n = sapply(split(dfs$publisher, dfs$publication_year), function (x) {length(unique(na.omit(x)))})
  df = data.frame(year = names(n), n = unname(n))
  p = ggplot(df, aes(x = year, y = n)) +
        geom_bar(stat = "identity") +
       ggtitle(paste("Publishers:", catalogue, place)) +
       scale_x_discrete(breaks = seq(min(sel.years), max(sel.years), 10))
  print(p)  

}
}
```






Title counts in selected places in the Kungliga catalogue.

```{r selectedplaces, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=6, out.width="280px"}
selected.places = c("Tartu", "Skara", "Växjö", "Uppsala", "Lund", "Strängnäs", "Linköping", "Gothenburg", "Västerås", "Nyköping", "Norrköping", "Stockholm", "Turku")
for (myplace in selected.places) {
  # Use timeinterval year intervals
  catal = "Kungliga"
  minyear = 1500
  #maxyear = 1800
  #minyear = min(na.omit(df0$publication_year))
  #maxyear = max(na.omit(df0$publication_year))  

  df = subset(df0, publication_place == myplace & catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year < maxyear)

  timeinterval <- 5
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot(data = dfm, aes(x = date, y = Documents))
  p <- p + geom_line(col = "black")
  p <- p + geom_smooth(col = "black")  
  p <- p + geom_point(col = "black", size = 3)
  p <- p + scale_x_continuous(breaks = seq(minyear, maxyear, 20), limits = c(minyear, maxyear))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(paste(myplace, " (", catal, ")", sep = ""))
  print(p)
}
```


Kungliga publications outside Sweden and Finland.

```{r selectedplaces2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=6, out.width="600px"}

  # Use timeinterval year intervals
  catal = "Kungliga"
  minyear = 1500

  df = subset(df0, !country %in% c("Finland", "Sweden") & catalog == catal)
  df <- subset(df, publication_year >= minyear & publication_year < maxyear)

  timeinterval <- 5
  df$timeunit <- round(df$publication_year/timeinterval)*timeinterval 

  df$unity = rep(1, nrow(df))
  publications <- tapply(df$unity, list(df$timeunit), sum)

  publications[is.na(publications)] <- 0 # Set NAs to 0
  publications <- publications/timeinterval # Instead of decadal sum, use average annual output 
  dfm <- melt(publications) 
  names(dfm) <- c("Time", "Documents")
  dfm <- transform(dfm, date = as.numeric(as.character(Time)))

  # Draw Figure
  theme_set(theme_bw(20))
  p <- ggplot(data = dfm, aes(x = date, y = Documents))
  p <- p + geom_line(col = "black")
  p <- p + geom_smooth(col = "black")  
  p <- p + geom_point(col = "black", size = 3)
  p <- p + scale_x_continuous(breaks = seq(minyear, maxyear, 20), limits = c(minyear, maxyear))
  p <- p + ggtitle("Publishing activity")
  p <- p + ylab("Documents / Year")
  p <- p + xlab("Year")
  p <- p + ggtitle(paste("Outside of Sweden and Finland", " (", catal, ")", sep = ""))
  print(p)

```


### Book printing in Finland 

Mitä voidaan sanoa suomalaisesta kirjatuotannosta ylipäänsä sekä
löydetäänkö sieltä mitään mielenkiintoisia kehityskulkuja ylipäänsä
vai pelkästään toteamus, että suomalainen tiedontuotanto oli hyvin
vähäistä tarkastellulla ajanjaksolla.

Kielikohtainen yleinen vertailu julkaisumääristä ja paperinkulutuksesta. Eli kaksi kuvaa (julkaisumäärät ja paperinkulutus kielittäin). Miten kielten kehitys suhtautuu toisiinsa (suomi kasvaa, latina laskee jne.)? Tarkkailtavia kielikategorioita on 5: suomi, ruotsi, latina, saksa sekä kategoria jossa kaikki muun kielisiset kuin edellä mainitut niputetaan yhteen.

DONE: Venäjän ja ranskankielisestä aineistosta omat graafit myös.


```{r language1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}

for (catalogue in c("Fennica", "Kungliga")) {

  df <- df0
  df <- df %>% filter(catalog == catalogue)

langs <- c("Finnish", "Swedish", "Latin", "German", "Russian", "French", "Other")
lang <- paste("language.", langs, sep = "")
otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0

dfl <- NULL

for (lan in lang) {

  # Classify a document to the specifed language
  # If document is assigned with languages, each case is considered
  # so one doc may have multiple entries corresponding to different languages
  # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
  # Combine data frames for specified languages
  dflsub <- filter(df, df[[lan]])
  dflsub$language <- gsub("language.", "", lan)
  dfl <- bind_rows(dfl, dflsub)
  
}
dfl$language <- factor(dfl$language, levels = langs)

df <- dfl %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))


# TITLE COUNT

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       xlab("Publication year") +
       ylab("Title count (n)") +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       xlab("Publication year") +
       ylab("Paper consumption") +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)

}
```


Analyysi voi tapahtua aikajanalla, mutta voisi myös ajatella suhteellista kehitystä tässä jollain muulla esitystavalla, olisiko se sitten jonkinlainen prosenttianalyysi? Tämä analyysi kannattaa jatkaa myös pidemmälle kuin 1828 Fennican osalta.


```{r language-perc, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
# TITLE COUNT
for (catalogue in c("Fennica", "Kungliga")) {

  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }
  
  df <- df %>% filter(catalog == catalogue)

langs <- c("Finnish", "Swedish", "Latin", "German", "Other")
lang <- paste("language.", langs, sep = "")
otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0

dfl <- NULL

for (lan in lang) {

  # Classify a document to the specifed language
  # If document is assigned with languages, each case is considered
  # so one doc may have multiple entries corresponding to different languages
  # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
  # Combine data frames for specified languages
  dflsub <- filter(df, df[[lan]])
  dflsub$language <- gsub("language.", "", lan)
  dfl <- bind_rows(dfl, dflsub)
  
}
dfl$language <- factor(dfl$language, levels = langs)

df <- dfl %>% group_by(publication_decade, language) %>%
     	     summarise(n = n())

# Calculate percentages
dff <- spread(df, language, n, fill = 0)
dff[, -1] <- 100 * t(apply(dff[, -1], 1, function (x) {x/sum(x)}))
dff <- gather(dff, publication_decade);
colnames(dff) <- c("publication_decade", "language", "f")
# Order languages by title count over the complete time span 
# (same ordering used with both catalogs)
dff$language <- factor(dff$language, levels = langs)

theme_set(theme_bw(20))
p <- ggplot(dff, aes(x = publication_decade, y = f)) +
     geom_bar(position = "stack", stat = "identity", aes(fill = language)) + 
     xlab("Publication year") +
     ylab("Title count frequency (%)") +
     ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)


}
```


Tärkeää on vertailu, mutta myös että nähdään kielikohtainen kehitys. Täten esim. pienemmän saksankielen kohdalla kannattaa varmaan piirtää erillinen kuva.


```{r language-sel, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
# TITLE COUNT
for (catalogue in c("Fennica", "Kungliga")) {

  df <- df0
  df <- df %>% filter(catalog == catalogue)

langs <- c("Finnish", "Swedish", "Latin", "German", "Other")
lang <- paste("language.", langs, sep = "")
otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0

dfl <- NULL

for (lan in lang) {

  # Classify a document to the specifed language
  # If document is assigned with languages, each case is considered
  # so one doc may have multiple entries corresponding to different languages
  # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
  # Combine data frames for specified languages
  dflsub <- filter(df, df[[lan]])
  dflsub$language <- gsub("language.", "", lan)
  dfl <- bind_rows(dfl, dflsub)
  
}
dfl$language <- factor(dfl$language, levels = langs)

df <- dfl %>% group_by(publication_year, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

for (sel.lan in "German") {

dfs <- filter(df, language == sel.lan)

theme_set(theme_bw(20))
p <- ggplot(dfs, aes(x = publication_year, y = n)) +
       geom_point(size = 2) +
       #geom_line() +
       geom_smooth(col = "black") +              
       xlab("Publication year") +
       ylab("Title count (n)") +
       ggtitle(paste("Languages (", sel.lan, "/", catalogue, ")", sep = ""))       
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(dfs, aes(x = publication_year, y = paper)) +
       geom_point(size = 2) +
       #geom_line() +
       geom_smooth(col = "black") +              
       xlab("Publication year") +
       ylab("Paper consumption") +
       ggtitle(paste("Languages (", sel.lan, "/", catalogue, ")", sep = ""))
print(p)

}
}
```


**TODO_Publishing in Finland_kieliolosuhteet_muualla 1**: Greifswaldin kieliprofiili vuoteen 1828 asti (käytännössä 1815) Kungligan materiaalin osalta. Onko Greifswaldissa samanlainen kielimonimuotoisuus läsnä kuin Turussa?



### BOOKINFINLAND-DONE2

Fennica, Hartaus- yms. kirjallisuuden kieli (suomi vai ruotsi) milloin alkaa yleistyä suomenkielinen ja miten tämän julkaiseminen suomeksi kasvaa? Toteutus, valitaan kaikki teokset joihin liittyy joku seuraavista asiasanoista: virret;arkkiveisut;hartauskirjat;katekismukset;rukouspäivät;saarnat;aapiset;rukoukset;rukous;hengelliset laulut;hartauspuheet;virsikirjat. Tämän jälkeen tarkkaillaan aikajanalla näiden teosten esiintymistä, erottavana tekijänä kieli (samat 5 kategoriaa kuin edellisessä analyysissä). Erilaisia tarkkailukulmia. Tämä analyysi kannattaa jatkaa myös pidemmälle kuin 1828 Fennican osalta. MT: Korjataan tätä kommenttia. Tässä data ei riitä siihen että kannattaa analyysia jatkaa. Eli siis 1828 takalautana kaikissa kuvissa. Näin viilaamalla noista erittäin hyvistä kuvista tuossa alla (ja kohdassa BOOKINFINLAND-DONE4) tulee vielä parempia.

TODO: Kungligan subject topiceista voisi tuottaa vastaavat niputettavat asiasanaryhmät Kungligalle (Jani ja Mikko): https://github.com/rOpenGov/kungliga/blob/master/output.tables/subject_topic_accepted.csv Näistä sitten oma analyysi joka suhtautuu Fennicaan.

NOTE: Kungliga is missing those subject topics hence skipped.

General analysis with all documents combined:

```{r topics, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
sel <- c("virret","arkkiveisut","hartauskirjat","katekismukset","rukouspäivät","saarnat","aapiset","rukoukset","rukous","hengelliset laulut","hartauspuheet","virsikirjat")
catalogue <- "Fennica"
  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }
  df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  

# Selected catalogue with selected topics
df <- df %>% filter(catalog == catalogue & hit)

langs <- c("Finnish", "Swedish", "Latin", "German", "Other")
lang <- paste("language.", langs, sep = "")
otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0
dfl <- NULL
for (lan in lang) {
  # Classify a document to the specifed language
  # If document is assigned with languages, each case is considered
  # so one doc may have multiple entries corresponding to different languages
  # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
  # Combine data frames for specified languages
  dflsub <- filter(df, df[[lan]])
  dflsub$language <- gsub("language.", "", lan)
  dfl <- bind_rows(dfl, dflsub)
}
dfl$language <- factor(dfl$language, levels = langs)

# -------------------------------------------

df <- dfl %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)
```



Same with selected publication places:


```{r topics.per.place, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}

for (place in c("Turku", "Stockholm", "Vaasa")) {

 df <- dfl %>% filter(publication_place == place)

 df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

 df$language <- factor(df$language, levels = names(table(df$language)))
 
# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", place, "/", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", place, "/", catalogue, ")", sep = ""))
print(p)

}
```


Same with top publishers

```{r topics.per.publisher, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
tops <-  names(top(fen, "publisher", 5))

for (publ in tops) {

  df <- dfl %>% filter(publisher == publ)

  df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(), paper = sum(paper.consumption.km2, na.rm = TRUE))

  df$language <- factor(df$language, levels = names(table(df$language)))

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", publ, "/", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", publ, "/", catalogue, ")", sep = ""))
print(p)

}
```


### BOOKINFINLAND-DONE3

Sama kuin edellä, mutta asiasanat tässä: hautajaiset;häät;juhlamenot


General analysis with all documents combined:

```{r topics2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
sel <- c("hautajaiset", "häät", "juhlamenot")

catalogue <- "Fennica"
  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }
  df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  

# Selected catalogue with selected topics
df <- df %>% filter(catalog == catalogue & hit)

langs <- c("Finnish", "Swedish", "Latin", "German", "Other")
lang <- paste("language.", langs, sep = "")
otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0
dfl <- NULL
for (lan in lang) {
  # Classify a document to the specifed language
  # If document is assigned with languages, each case is considered
  # so one doc may have multiple entries corresponding to different languages
  # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
  # Combine data frames for specified languages
  dflsub <- filter(df, df[[lan]])
  dflsub$language <- gsub("language.", "", lan)
  dfl <- bind_rows(dfl, dflsub)
}
dfl$language <- factor(dfl$language, levels = langs)

# -------------------------------------------

df <- dfl %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)
```



Same with selected publication places:


```{r topics2.per.place, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}

for (place in c("Turku", "Stockholm", "Vaasa")) {

 df <- dfl %>% filter(publication_place == place)

 df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

 df$language <- factor(df$language, levels = names(table(df$language)))
 
# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", place, "/", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", place, "/", catalogue, ")", sep = ""))
print(p)

}
```


Same with top publishers

```{r topics2.per.publisher, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
tops <-  names(top(fen, "publisher", 5))

for (publ in tops) {

  df <- dfl %>% filter(publisher == publ)

  df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(), paper = sum(paper.consumption.km2, na.rm = TRUE))

  df$language <- factor(df$language, levels = names(table(df$language)))

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", publ, "/", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", publ, "/", catalogue, ")", sep = ""))
print(p)

}
```





### BOOKINFINLAND-DONE4

edellisten yhdistäminen, eli täsmälleen samat analyysit, mutta asiasanoina kaikki (todo2 ja todo3), eli: virret;arkkiveisut;hartauskirjat;katekismukset;rukouspäivät;saarnat;aapiset;rukoukset;rukous;hengelliset laulut;hartauspuheet;virsikirjat;hautajaiset;häät;juhlamenot

Hartauskirjallisuudesta ks. Osmo Tiililä, Rukoilevaisten kirjoja, 1961.


General analysis with all documents combined:

```{r topics3, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
sel <- c("virret","arkkiveisut","hartauskirjat","katekismukset","rukouspäivät","saarnat","aapiset","rukoukset","rukous","hengelliset laulut","hartauspuheet","virsikirjat","hautajaiset","häät","juhlamenot")
catalogue <- "Fennica"
  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }
  df$hit <- apply((sapply(sel, function (x) {grepl(x, tolower(df$subject_topic))})), 1, any)  

# Selected catalogue with selected topics
df <- df %>% filter(catalog == catalogue & hit)

langs <- c("Finnish", "Swedish", "Latin", "German", "Other")
lang <- paste("language.", langs, sep = "")
otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0
dfl <- NULL
for (lan in lang) {
  # Classify a document to the specifed language
  # If document is assigned with languages, each case is considered
  # so one doc may have multiple entries corresponding to different languages
  # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
  # Combine data frames for specified languages
  dflsub <- filter(df, df[[lan]])
  dflsub$language <- gsub("language.", "", lan)
  dfl <- bind_rows(dfl, dflsub)
}
dfl$language <- factor(dfl$language, levels = langs)

# -------------------------------------------

df <- dfl %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)
```



Same with selected publication places:


```{r topics3.per.place, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}

for (place in c("Turku", "Stockholm", "Vaasa")) {

 df <- dfl %>% filter(publication_place == place)

 df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

 df$language <- factor(df$language, levels = names(table(df$language)))
 
# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", place, "/", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", place, "/", catalogue, ")", sep = ""))
print(p)

}
```


Same with top publishers

```{r topics3.per.publisher, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
tops <-  names(top(fen, "publisher", 5))

for (publ in tops) {

  df <- dfl %>% filter(publisher == publ)

  df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(), paper = sum(paper.consumption.km2, na.rm = TRUE))

  df$language <- factor(df$language, levels = names(table(df$language)))

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", publ, "/", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", publ, "/", catalogue, ")", sep = ""))
print(p)

}
```



### BOOKINFINLAND-DONE4

Kielikohtainen vertailu myös lääketieteen osalta. Ajatuksena tässä on, että hartauskirjallisuutta on hyvä verrata tiedejulkaisemiseen. 1800-luvun jukisuuteen kuuluu vahvasti tarina kansallisista tieteista (historia, suomen kieli, folkloristiikka jne), ja niissä suomenkielen nusu on aika hyvin selvitetty juttu. Sama koskee tiedejulkaisemista, mutta siinä argumentit olivat erilaiset. Tästä on Katja Huumon väitöskirja ”Perkeleen kieli”, jossa käydään laadullisen tutkimuksen kautta tieteen kielikiistoja 1800-luvulla. Ajattelen, että lääketieteen osalta asiasanat ovat ehkä kaikkein luotettavimmat, joten voisi tarkastella lääketiedettä ja verrata siihen hartauskirjallisuuteen. Hartauskirjallisuuden osaltahan pyrkimys suomeksi julkaisemiseen oli kovin vahva koska se tieto oli kansalle tärkeää. Lääketieteellinenkin tieto kansallistettiin, mutta myöhemmin.

Eli: Fennicasta kaikki kirjallisuus, jossa asiasana lääketiede (muut lääkeaiheiset eivät välttämättä kuulu tähän, noita on muuten kummallisen vähän). Tätä pitää jatkaa mielellään vuoteen 1900 asti, tai ainakin yhtää pitkälle kuin hartauskirjojakin.

Title count for different places. Fennica, no time limit.

```{r medicne, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
dfs <-subset(df.full, catalog == "Fennica");
print(sort(table(dfs[grep("lääketiede", dfs$subject_topic),"publication_place"])))
```

General analysis with all documents combined:

```{r topics4, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}
sel <- "lääketiede"
catalogue <- "Fennica"
  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }
  df$hit <- grepl(sel, tolower(df$subject_topic))

# Selected catalogue with selected topics
df <- df %>% filter(catalog == catalogue & hit)

langs <- c("Finnish", "Swedish", "Latin", "German", "Other")
lang <- paste("language.", langs, sep = "")
otherlang <- setdiff(names(df)[grep("lang.", names(df))], lang)
df$language.Other <- rowSums(df[, otherlang] == TRUE, na.rm = T) > 0
dfl <- NULL
for (lan in lang) {
  # Classify a document to the specifed language
  # If document is assigned with languages, each case is considered
  # so one doc may have multiple entries corresponding to different languages
  # mean(rowSums(df[, lang]) == 1) # 93% Fennica docs have just 1 language
  # Combine data frames for specified languages
  dflsub <- filter(df, df[[lan]])
  if (nrow(dflsub) > 0) {
    dflsub$language <- gsub("language.", "", lan)
    dfl <- bind_rows(dfl, dflsub)
  }
}
dfl$language <- factor(dfl$language, levels = names(table(dfl$language)))

# -------------------------------------------

df <- dfl %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)


# PAPER CONSUMPTION

theme_set(theme_bw(20))
p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       #geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       # geom_smooth(aes(col = language)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +
       # ylim(c(0, 1.1*max(npub$paper.per.title))) +
       ggtitle(paste("Languages (", catalogue, ")", sep = ""))
print(p)
```




Kaupungittain vertailu on kiinnostavaa, koska tuntuma on, että Turun ja Helsingin osalta ei latinan, ranskan ja saksankielista matskua pitäisi löytyä. Silloin vernakularisointi tapahtuu erityisesti muualla. HUOM: Helsingissä ei ole painettu mitään asiasanalla lääketiede.

Huumo, Katja. "Perkeleen kieli" : suomen kieli ja poliittisesti korrekti tiede 1800-luvulla, Helsinki : Suomen tiedeseura, 2005.



```{r topics4.per.place, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6, out.width="430px", fig.show="hold"}

for (place in c("Turku", "Uppsala")) {

 df <- dfl %>% filter(publication_place == place)

 df <- df %>% group_by(publication_decade, language) %>%
             summarise(n = n(),
	               paper = sum(paper.consumption.km2, na.rm = TRUE))

 df$language <- factor(df$language, levels = names(table(df$language)))
 
  # TITLE COUNT
  theme_set(theme_bw(20))
  p <- ggplot(df, aes(x = publication_decade, y = n, group = language)) +
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       xlab("Publication year") +
       ylab("Title count (n)") +
       ggtitle(paste("Languages (", place, "/", catalogue, ")", sep = ""))
  print(p)


  # PAPER CONSUMPTION
  theme_set(theme_bw(20))
  p <- ggplot(df, aes(x = publication_decade, y = paper, group = language)) +
       geom_point(aes(col = language, shape = language), size = 5) +
       geom_line(aes(col = language, shape = language)) +       
       xlab("Publication year") +
       ylab("Paper consumption") +
       ggtitle(paste("Languages (", place, "/", catalogue, ")", sep = ""))
  print(p)

}
```

TODO_Publishing in Finland #: Kaaviot Fennicasta, jossa lasketaan eri kielten mukaan asiasanojen määrä eri vuosina. Asiasanat ovat osin arbriträärisiä, mutta ehkä niiden määrän pohjalta voidaan sanoa jotain siitä millä kielellä on julkaistu mitäkin. Minusta voisi tehdä kaavion vuoteen 1828 sekä toisen vuoteen 1900. Tiedän että 1800-luvun osalta Fennicassa on kielellinen bias, mutta esim. suomenkielen tarkastelun kannalta tällä ei ole merkitystä, sillä kaikki suomenkielinen materiaali on tarkkaan läpikäytyä. Tässä näky toivottasti se millä tavalla 1855 jälkeen suomenkielinen julkaiseminen laajeni. Kaavio joka näyttää asiasanat vuoteen 1828 auttaa toivottavasti asettamaan 1700-luvun suomenkielisen hartauskirjallisuuden kontekstiinsa.

### BOOKINFINLAND-5

Samat analyysit kuin yllä, seuraavat asiasanaryppäät. Tarkoituksena analysoida yliopisto-opetuksen muutosta. Kokonaismäärät ja kielikohtaiset vaihtelut kiinnostavat. 

i) kirkkohistoria;raamatunhistoria;eksegetiikka;homiletiikka;dogmatiikka;teologia

ii) oppihistoria;antiikki;historia

iii) filosofia;luonnonfilosofia;metafysiikka;logiikka

iv) luonnontieteet;matematiikka;fysiikka;kemia;tähtitiede;maantiede;geodesia;geofysiikka;meteorologia

v) retoriikka;poetiikka;kielitiede;kielioppi

vi) heprean kieli;kreikan kieli;latinan kieli

vii) psykologia;yhteiskuntafilosofia;valtiofilosofia;talous;raha;moraali;velvollisuudet;kasvatus;maanviljely;maatalous;kalastus

viii) luonnonhistoria;lääketiede;tartuntataudit;eläintiede;kasvitiede;kasvisto;eläimet;eläinsuojelu;eläimistö;eläintaudit;hevonen

ix) naiset;naisen asema;naisasialiikkeet;naisasiajärjestöt

x) etsintäkuulutukset;rikokset;oikeus;rangaistukset

Näissä kiinnostaa myös julkaisijakohtaiset vaihtelut (tai oikeastaan kaikki kuvat joita esim. BOOKINFINLAND-4:ssa. Tämä vain jatkaa siitä mihin tuo edellinen jää.

### Book as media: development over time

Paper consumption per document in the top publication places. Note
that paper consumption estimates have still problems so take this with
reservations. Are there time periods with remarkable changes in paper
consumption per document (meaning that small or large volumes suddenly
become more frequent) ?


```{r bookmedia2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=7, fig.show="hold", out.width="430px"}
for (catal in as.character(unique(df0$catalog))) {
  df <- subset(df0, catalog == catal)
  theme_set(theme_bw(20))
  top <- names(top(df, "publication_place", 10))

  dfs <- df %>% filter(publication_place %in% top) %>% group_by(publication_decade, publication_place, country) %>% summarize(n = n(), paper = sum(paper.consumption.km2, na.rm = T))  %>% mutate(paper.per.document = paper/n)

  p <- ggplot(dfs, aes(x = publication_decade, y = paper.per.document)) +
       geom_point(aes(color = publication_place, shape = publication_place)) +
       geom_line(aes(color = publication_place, linetype = publication_place)) +
       xlab("Title Count") + 
       ggtitle(paste("Paper consumption per document\n", catal)) +
       scale_y_log10() 
  print(p)	 
}
```




Overview on how over 50 page documents spread in time. Paper
consumption in books (over 50 pages; balls) versus other documents
(less or equal than 50 pages; triangles). TODO: voidaanko tässä nähdä
paikallisia eroja ?

```{r bookmedia1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=7, fig.show="hold", out.width="430px"}
for (catal in unique(df0$catalog)) {
  df2 <- subset(df0, catalog == catal)
  pagelimit = 50
  df2$document.type <- rep(NA, nrow(df2))
  df2$document.type[df2$pagecount > pagelimit] <- "book"
  df2$document.type[df2$pagecount <= pagelimit] <- "pamphlet"
  df2 <- df2[which(!is.na(df2$document.type)),]
  df2$document.type <- factor(df2$document.type)
  df2 <- df2 %>% group_by(publication_decade, document.type) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
  p <- ggplot(df2, aes(x = publication_decade, y = paper.consumption.km2, group = document.type))
  p <- p + geom_point(aes(shape = document.type), size = 5)
  p <- p + geom_smooth(method = "loess", color = "black")
  p <- p + ggtitle("Paper consumption per document type")
  p <- p + xlab("Year")
  p <- p + ylab("Paper consumption (km2)")
  p <- p + scale_color_manual(values=c("black", "darkgray"))
  p <- p + ggtitle(catal)
  print(p)
}
```


Average paper consumption per document over time:

```{r LIBER-11, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=8, fig.width=12, out.width="600px"}
theme_set(theme_bw(25))
library(sorvi)
dfs <- df0 %>% group_by(publication_decade) %>%
         summarize(paper.per.doc = mean(paper.consumption.km2, na.rm = T))
p <- ggplot(dfs, aes(y = paper.per.doc, x = publication_decade)) +
       geom_point() + geom_smooth(method = "loess", size = 1, color = "black") +
       xlab("Publication year") + ylab("Paper per document") +
       ggtitle("Average paper consumption per document")
print(p)
```




The development of book formats over time. Folios (1to ja 2to) are
largely missing (in contrast to ESTC). Moreover, the quarto (4to) and
octavo (8vo) increase rapidly in 1700s.


```{r papercompbyformat, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=7, fig.show="hold", out.width="430px"}
for (catal in unique(df0$catalog)) {
  dfs <- df0 %>% filter(!gatherings == "NA" & catalog == catal) 

  res <- titlecount_timeline(dfs, "gatherings", nmin = 15, mode = "n") 
  print(res$plot + ggtitle(paste(catal, " (n)", sep = "")))
 
  res <- titlecount_timeline(dfs, "gatherings", nmin = 15, mode = "percentage") 
  print(res$plot + ggtitle(paste(catal, " (%)", sep = "")))
}
```


Paper consumption for different document formats over time. Each point represents a decade. Loess smoothing. 

```{r LIBER-13, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=10, fig.height=8, fig.show="hold", out.width="430px"}
for (catal in unique(df0$catalog)) {
  df2 <- subset(df0, catalog == catal) %>% group_by(publication_decade, gatherings) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
  df2 <- filter(df2, gatherings %in% setdiff(names(which(table(df2$gatherings) >= 15)), "NA"))
  p <- ggplot(df2, aes(y = paper.consumption.km2, x = publication_decade, shape = gatherings, linetype = gatherings))
  p <- p + geom_point(size = 4)
  p <- p + geom_smooth(method = "loess", size = 1, color = "black")
  p <- p + ggtitle("Paper consumption in time by gatherings")
  p <- p + xlab("Year")
  p <- p + ylab("Paper consumption (km2)")
  p <- p + guides(linetype = guide_legend(keywidth = 5), shape = guide_legend(keywidth = 5))
  p <- p + ggtitle(paste("Paper consumption\n(", catal, ")", sep = ""))
  print(p)
}
```

Tässä on meille tärkeät kuvat. Erityisesti paper consumption (Kungliga) kertoo Valistuksen voittokulusta Euroopassa. Octavo kokoisten kirjojen paper consumption on merkki kirjojen merkityksen korostumisesta ja muutoksesta. Sama päti ESTCn. Suomi taas tulee tässä orastavasti perässä kirjatuotannon puolesta. Mitä me halutaan sanoa tästä suomalaisen sivistysvaltion myöhemmästä kehityksestä?

Paper consumption in selected places (Fennica):

```{r 201606krakow-turkuvsother, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=10, fig.show="hold", out.width="430px"}
df <- fen %>% 
      filter(!is.na(country)) %>%
      filter(!is.na(publication_place) & !is.na(paper.consumption.km2) & paper.consumption.km2 > -0.01)

# Add indicator field: Turku or Not Turku
myplace <- "Turku"

df$myplace <- rep(NA, nrow(df))
df$myplace[df$publication_place == myplace] <- myplace
df$myplace[!df$publication_place == myplace & df$country == "Finland"] <- "Finland"
df$myplace[!df$country == "Finland" & !df$publication_place == myplace] <- "Foreign"
df$myplace <- factor(df$myplace, levels = rev(c("Foreign", "Finland", "Turku")))

# Keep entries with known publication place and paper consumption
# Group by year/decade and Turku/Other
dfs <- df %>% group_by(publication_decade, myplace) %>%
  summarise(titles = n(), paper = sum(paper.consumption.km2, na.rm = TRUE))

p <- ggplot(dfs, aes(x = publication_decade, y = paper, fill = myplace, order = -as.numeric(myplace))) +
     geom_bar(position = "stack", stat = "identity", color = "black") +
     ggtitle("Paper consumption") +
     #scale_fill_manual(values = c("blue", "black", "darkgreen")) +
     scale_fill_grey() +
     guides(fill = guide_legend(reverse = TRUE, title = "")) + 
     xlab("Publication decade") + ylab("Paper (km2)")
print(p)


p <- ggplot(dfs, aes(x = publication_decade, y = titles, fill = myplace, order = -as.numeric(myplace))) +
     geom_bar(position = "stack", stat = "identity", color = "black") +
     ggtitle("Title count") +
     # scale_fill_manual(values = c("blue", "black", "darkgreen")) +
     scale_fill_grey() +
     guides(fill = guide_legend(reverse = TRUE, title = "")) +      
     xlab("Publication decade") + ylab("Title count (n)")
print(p)
```


### Dynamics and evolution of publisher networks

Observed trends in Fennica regarding Finnish knowledge production
1640-1828, focusing on the appearance of new publishers on the
publishing landscape.

How new publishers appear and disappear from the Finnish publishing
landscape. We have analyzed the number of unique publication places
and unique publishers in terms of title count and paper consumption
over Finland in general, and more specifically within the top
publication places over time.


Number of unique publishers per decade in Finland and elsewhere (based on the Fennica catalogue).

```{r publishers-finland, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=10, fig.show="hold", out.width="430px"}
# Unique publishers
df <- df0
# Indicator Finland yes/no
df$Finland <- (df$country == "Finland")

df <- df %>%
        filter(catalog == "Fennica" & !is.na(Finland)) %>%
        filter(publication_year >= 1640 & publication_year <= 1828) %>%	
        select(publisher, publication_decade, Finland)
npub <- unique(df) %>% group_by(publication_decade, Finland) %>% tally()
theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = n, group = Finland)) +
       geom_point(aes(shape = Finland), size = 5) +
       geom_line(col = "black", aes(shape = Finland)) +       
       geom_smooth(col = "black") + 
       xlab("Publication year") +
       ylab("Unique publishers (n)") +        
       ggtitle("Unique publishers (Fennica)")
print(p)

# -----------------------------

# Unique publication places
df <- df0
df <- df %>%
        filter(catalog == "Fennica" & country == "Finland") %>%
        filter(publication_year >= 1640 & publication_year <= 1828) %>%	
        select(publication_decade, publication_place)
npub <- unique(df) %>% group_by(publication_decade) %>% tally()
theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = n)) +
       geom_point(size = 5) +
       geom_line(col = "black") +       
       geom_smooth(col = "black") + 
       xlab("Publication year") +
       ylab("Unique publication places (n)") +        
       ggtitle("Unique publication places in Finland (Fennica)")
print(p)

# Places in Fennica Finland 1770
#unique(subset(df0, catalog == "Fennica" & publication_decade == 1770 & country == "Finland")$publication_place)
```



Number of unique publishers in top publication places over time (Fennica):

```{r publishers2-finland, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=15}
df <- df0
df <- df %>%
        filter(catalog == "Fennica" & country == "Finland") %>%
        filter(publication_year >= 1640 & publication_year <= 1828)

# Top publication places
ntop <- 10
top <- names(top(df, "publication_place", ntop))

df <- df %>%	
        filter(publication_place %in% top) %>%	
        select(publication_decade, publication_place, publisher)
	
npub <- unique(df) %>% group_by(publication_decade, publication_place) %>% tally()
npub$publication_place <- factor(npub$publication_place, levels = top)
theme_set(theme_bw(20))

p <- ggplot(npub, aes(x = publication_decade, y = n)) +
       geom_bar(stat = "identity", position = "stack", aes(fill = publication_place)) + 
       #geom_point(size = 5, aes(shape = publication_place)) +
       #geom_line(col = "black", aes(shape = publication_place)) +       
       # geom_smooth(col = "black", aes(shape = publication_place)) + 
       xlab("Publication year") +
       ylab("Unique publishers (n)") +        
       ggtitle("Unique publishers in top publication places (Finland/Fennica)")
print(p)
```
MITEN ON MAHDOLLISTA, ETTÄ VYBORG EI NÄY TÄSSÄ? Tai jos syynä että merkattu Suomen ulkopuolelle, niin se pitäisi saada tähän poikkeuksena mukaan. Tuolla alkupäässä sen pitäisi näkyä.

Number of unique publishers in selected publication places over time
(Kungliga). [Julkaisijoiden osalta Kungligan aineiston osalta samat
analyysit Tukholmasta, Lundista, Uppsalasta ja Greifswaldista. Tämä
mahdollistaa Turun sijoittamisen kontekstiin.]


```{r publishers2-kungliga, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=15}
df <- df0
catalogue <- "Kungliga"
df <- df %>%
        filter(catalog == catalogue) %>%
        filter(publication_year >= 1640 & publication_year <= 1828)

# Selected publication places
top <- c("Stockholm", "Lund", "Uppsala", "Greifswald")
df <- df %>%	
        filter(publication_place %in% top) %>%	
        select(publication_decade, publication_place, publisher)
	
npub <- unique(df) %>% group_by(publication_decade, publication_place) %>% tally()
npub$publication_place <- factor(npub$publication_place, levels = top)
theme_set(theme_bw(20))

p <- ggplot(npub, aes(x = publication_decade, y = n)) +
       geom_bar(stat = "identity", position = "stack", aes(fill = publication_place)) + 
       xlab("Publication year") +
       ylab("Unique publishers (n)") +        
       ggtitle(paste("Unique publishers in selected publication places (", catalogue, ")"))
print(p)
```





**PUBLISHER-TODO2** (Done?) Analysis of the top publishers publishing
  profile (title count and paper consumption) over time. DONE: now
  also added for Kungliga.


Title count per top publisher (two alternative visualizations):

MT: Näissä ensimmäisissä kuvissa myös aikarajaus niin että loppuu 1828.

```{r publishers3-finland, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=15, fig.show="hold"}
for (catalogue in c("Fennica", "Kungliga")) {

place <- "Turku"

  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }

df <- df %>%
        filter(catalog == catalogue & publication_place == place) 

df <- df %>%	
        select(publication_decade, publisher, paper.consumption.km2)

# Group small publishers
# Top publishers by title count
ntop <- 10
top <- names(top(df, "publisher", ntop))
df$publisher[!df$publisher %in% top] <- "Other"
df$publisher <- factor(df$publisher, c(top, "Other"))

# Title count per decade & publisher	
npub <- df %>% group_by(publication_decade, publisher) %>% tally()

# TITLE COUNT
theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = n)) +
       geom_bar(stat = "identity", position = "stack", aes(fill = publisher)) + 
       #geom_point(size = 5, aes(shape = publication_place)) +
       #geom_line(col = "black", aes(shape = publication_place)) +       
       # geom_smooth(col = "black", aes(shape = publisher)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +        
       ggtitle(paste("Title count per publisher (", place, "/", catalogue, ")", sep = ""))
print(p)

# -------------------------------------

# PAPER CONSUMPTION
  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }

df <- df %>%
        filter(catalog == catalogue & publication_place == place)

df <- df %>%	
        select(publication_decade, publisher, paper.consumption.km2)

# Group small publishers
# Top publishers
ntop <- 5
top <- names(top(df, "publisher", ntop))
df$publisher[!df$publisher %in% top] <- "Other"
df$publisher <- factor(df$publisher, c(top, "Other"))

# Publishing per decade & publisher	
npub <- df %>%
     	  group_by(publication_decade, publisher) %>%
	  summarize(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n()) %>%
	  mutate(paper.per.title = paper/n)

theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = n)) +
       geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       #geom_point(size = 5, aes(shape = publisher)) +
       #geom_line(col = "black", aes(shape = publisher)) +       
       # geom_smooth(col = "black", aes(shape = publisher)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +        
       ggtitle(paste("Title count (", place, "/", catalogue, ")", sep = ""))
print(p)

}
```


Paper consumption per top publisher (two alternative visualizations):

```{r publishers4-finland, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=15}
for (catalogue in c("Fennica", "Kungliga")) {

  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }
  
df <- df %>%
        filter(catalog == catalogue & publication_place == place)

df <- df %>%	
        select(publication_decade, publisher, paper.consumption.km2)

# Group small publishers
# Top publishers by title count
ntop <- 10
top <- names(top(df, "publisher", ntop))
df$publisher[!df$publisher %in% top] <- "Other"
df$publisher <- factor(df$publisher, c(top, "Other"))

# Publishing per decade & publisher	
npub <- df %>% group_by(publication_decade, publisher) %>% summarize(paper = sum(paper.consumption.km2, na.rm = TRUE))

theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = paper)) +
       geom_bar(stat = "identity", position = "stack", aes(fill = publisher)) + 
       #geom_point(size = 5, aes(shape = publication_place)) +
       #geom_line(col = "black", aes(shape = publication_place)) +       
       # geom_smooth(col = "black", aes(shape = publisher)) + 
       xlab("Publication year") +
       ylab("Paper consumption") +        
       ggtitle(paste("Paper consumption per publisher (", place, "/", catalogue, ")", sep = ""))
print(p)




  if (catalogue == "Fennica") {
    df <- df.full # full time span
  } else if (catalogue == "Kungliga") {
    df <- df0 # selected time span
  }

df <- df %>%
        filter(catalog == catalogue & publication_place == place)

df <- df %>%	
        select(publication_decade, publisher, paper.consumption.km2)

# Group small publishers
# Top publishers
ntop <- 5
top <- names(top(df, "publisher", ntop))
df$publisher[!df$publisher %in% top] <- "Other"
df$publisher <- factor(df$publisher, c(top, "Other"))

# Publishing per decade & publisher	
npub <- df %>%
     	  group_by(publication_decade, publisher) %>%
	  summarize(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n()) %>%
	  mutate(paper.per.title = paper/n)

theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = paper)) +
       geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       xlab("Publication year") +
       ylab("Paper") +        
       ggtitle(paste("Paper (", place, "/", catalogue, ")", sep = ""))
print(p)
}
```



Tärkeänä kysymyksenä on mitä eri julkaisijat julkaisee. Top-5
julkaisijoista voisi tuottaa julkaisujen yhteiset, julkaisijakohtaiset
asiasanalistat (mitä asiasanoja yhden julkaisijan kaikista töistä
löytyy) jotka voitaisiin sitten käsin ryhmitellä isompiin
kategorioihin (esim. yliopistojulkaisu, uskonnollinen teksti,
säädökset, kaunokirjallinen ja muut (tai vast.)). Näin pystyttäisiin
puhumaan siitä minkälainen julkaisija on kyseessä, muuttuuko profiili
asiasanojen esiintymisen mukaan aikajanalla sekä nähdä onko
julkaisijoiden kohdalla tässä mitään eroja.

OK, see lists for  

  * [Frenckell Johan Christopher II](output.tables/subjecttopicsFrenckell_Johan_Christopher_II.tab)
  * [Frenckell Johan Christopher I](output.tables/subjecttopicsFrenckell_Johan_Christopher_I.tab)
  * [Hansson Peter](output.tables/subjecttopicsHansson_Peter.tab)
  * [Londicer Georg Wilhelm](output.tables/subjecttopicsLondicer_Georg_Wilhelm.tab)
  * [Wall Johan Larsson](output.tables/subjecttopicsWall_Johan_Larsson.tab)   


```{r publishers-subtop, echo=FALSE, message=FALSE, warning=FALSE}
#Top-5 julkaisijoista voisi julkaisujen yhteiset, julkaisijakohtaiset
#asiasanalistat (mitä asiasanoja yhden julkaisijan kaikista töistä
#löytyy)
catalogue <- "Fennica"
df <- df0
df <- df %>%
        filter(catalog == catalogue) %>%
        filter(publication_year >= 1640 & publication_year <= 1828)

# Selected ones
top <- names(top(df, "publisher", 5))
df <- df %>% filter(publisher %in% top)

spl <- split(df$subject_topic, df$publisher)
x <- lapply(spl, function (x) {unlist(strsplit(x, ";"))})

for (pn in names(x)) {
  fnam <- gsub(",", "", gsub(" ", "_", pn))
  write_xtable(x[[pn]], file = paste(output.folder, "subjecttopics", fnam, ".tab", sep = ""))
}
```



**Londicer versus Frencell** “Siinä missä Londicer 1700-luvun Vaasassa
     näyttää aina julkaisseen asetukset jonkinlaisena
     kokoomapainoksena, mutta Frenckellin kirjapainosta ne tuli
     yksitellen. Siten Frenckellin julkaisemien niteiden määrä saattaa
     näyttää suurelta verrattuna Londiceriin, mutta itse asiassa
     sisältömäärä on sama”.  Tätä hypoteesia voidaan yrittää
     todentaa/tarkistaa/korjata kun mukana on paperinkulutus. Eli jos
     verrataan Londicer ja Frenckell paperinkulutusta vuositasolla ja
     julkaisujen määrää, niin tästä pitäisi pystyä sanomaan jotain.



```{r publishers5-finland, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=7, fig.width=15}
catalogue <- "Fennica"
df <- df0
df <- df %>%
        filter(catalog == catalogue) %>%
        filter(publication_year >= 1750 & publication_year <= 1828)

df <- df %>%	
        select(publication_decade, publisher, paper.consumption.km2)

# Selected ones
top <- c("Frenckell, Johan Christopher I", "Londicer, Georg Wilhelm", "Frenckell, Johan Christopher II")
df$publisher[!df$publisher %in% top] <- "Other"
df$publisher <- factor(df$publisher, c(top, "Other"))

# Publishing per decade & publisher	
npub <- df %>%
     	  group_by(publication_decade, publisher) %>%
	  summarize(paper = sum(paper.consumption.km2, na.rm = TRUE), n = n()) %>%
	  mutate(paper.per.title = paper/n)

theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = n, group = publisher)) +
       geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       xlab("Publication year") +
       ylab("Title count (n)") +        
       ggtitle(paste("Title count (", catalogue, ")", sep = ""))
print(p)


theme_set(theme_bw(20))
p <- ggplot(npub, aes(x = publication_decade, y = paper, group = publisher)) +
       geom_bar(stat = "identity", position = "dodge", aes(fill = publisher)) + 
       xlab("Publication year") +
       ylab("Paper") +        
       ggtitle(paste("Paper (", catalogue, ")", sep = ""))
print(p)
```



**PUBLISHER-TODO** (jos ehtii)

TODO_Publisher analysis_#: Kaaviot Fennicasta ja Kungligasta, jossa lasketaan eri julkaisijoiden. Asiasanat ovat osin arbriträärisiä, mutta ehkä niiden määrän pohjalta voidaan sanoa jotain eri julkaisijoiden profiilien muutoksista. Laaditaan kaaviot 1828. 

  * Fennican julkaisijoita voisi myös laajemmin yrittää luokitella
    suhteellisesti (“iso”, “keskikokoinen”, “pieni”) liittyen
    vuosittaiseen julkaisuvoluumiin jota mitataan niin julkaisujen
    määrän kuin myös paperinkulutusvoluumin suhteen. Tällä tavalla
    olisi helpompi hahmottaa eri kaupungeissa tapahtuvaa
    kehitystä. Vertailua suurimpien julkaisijoiden kesken.

  * AJATUKSIA: Julkaisijoiden ilmentyminen kartalle
    paperinkulutusvoluumi huomioiden: julkaisutoiminnan leviäminen ja
    kasvu ajassa eri paikkakunnilla. Paperinkulutus voi osoittautua
    hyväksi työvälineeksi erityisesti kun tiedetään, että toiset isot
    julkaisijat julkaisivat esim. jotain asetuskokoelmia yksittäin ja
    toiset taas ryppäinä. Eli julkaisijoiden sisällä erottelua eri
    tyyppisten julkaisujen suhteen pitää tehdä.

  * Julkaisijoista tehtävä verkostoanalyysi. keskeisimmät “nodet”
    siihen miten julkaisijakenttä muuttuu ajassa. Julkaisijoita voisi
    myös yrittää luokitella eniten käytettyjen asiasanojen
    mukaan. Näiden perusteella voidaan varmaankin erotella
    yliopistojulkaiseminen, asiakirja/asetusjulkaiseminen ja
    kirjajulkaiseminen. Tämän jälkeen auktorit, valtioasiakirjat,
    yliopistodokumentit, kirjat ja muut julkaisut kategoroina joiden
    ympärille verkostoanalyysi voisi syntyä (valtionasiakirjojen ja
    yliopisto-aineiston luokittelu voisi yhdistää myös asiasanojen ja
    otsikoiden analyysia). [OK monenlaista voidaan tehdä, onko tämä
    asiasanajuttu nyt tärkeä vai vähemmän tärkeä prioriteetti?]


### University publishing

Yliopistojulkaisuista mahd. pian yleiset tilastolliset näkymät ja
voidaan sitten arvioida onko joku mahdollisesti pahastikin vielä
pielessä esim. väitöskirjoiksi Kungligan osalta luokiteltavissa
aineistoissa.

Yleinen tilasto "väitöskirjaksi" merkityistä teoksista (aikajana,
julkaisupaikka) olisi hyvä Kungligan osalta. Tämä toimii lähtökohtana
että nähdään sisällöstä jotain: milloin niitä väitöskirja-luokiteltuja
teoksia Kungligassa on merkitty julkaistuiksi sekä missä. Tämän
vertaaminen Fennican pohjalta samaan eli "väitöskirjaksi" täggättyihin
on tärkeää.

analyysi mitä julkaisukentällä tapahtuu eri paikoissa kun uusia
julkaisijoita tulee kartalle (meneekö esim. jossain toisessa
yliopistossa tuotanto suhteessa alas kun matkan varrella tulee uusia
yliopistoja vai ei) jne.

Yliopistojen ilmestyminen ruotsinvaltakunnassahan on (ks. aikajanat):

Uppsala: 1477

Tartu / Dorpat / Tarto (eikös paikkakunnittain synonyymit toimi jo?): 1633

Turku: 1640

Lund: 1666

Greifwald: 1456 (Ruotsin systeemissä 1600-1815)

Greifswald mukaan yliopistoanalyysiin. osana Ruotsin valtakuntaa.

Tätä kautta päästään hyvin kiinni Turku, Upsala,
Lund, Tarto yms. vertailuihin. Siitä sitten kuljetaan kohti Turun
suhdetta muuhun Suomeen ja katso kääntyy erityisesti julkaisijoihin
(samaten toki myös noiden yliopistokaupunkien osalla, jossa myös
tehdään sitten vertailua akateeminen vs. hallinnollinen vs. muu
julkaisutoiminta).


**Dissertation language** milloin alkaa erityisesti tulemaan ruotsinkielellä väitöksiä eri paikoissa on mielenkiintoinen kysymys. tuleeko jostain yliopistosta
erityisesti ruotsinkielistä materiaalia 1700-luvulla.  pitää
erityisesti analysoida niitä väitöskirjoja sekä niissä tapahtuvia
muutoksia. See [Fennica](https://github.com/rOpenGov/fennica/blob/master/inst/examples/language.md) and [Kungliga](https://github.com/rOpenGov/kungliga/blob/master/antagomir/language.md),



### Case of Turku

Turun akateemisen julkaisemisen vertautuminen muihin ruotsalaisen
yliopistojärjestelmän kaupunkeihin: Lukumäärävertailut
aikajanalla. Akateemisten julkaisujen blokkaaminenhan ei pitäisi olla
kovinkaan hankalaa [väitöskirjat, mitä muuta tähän siis?]. 

Turku vs. muu Suomi: Turku osana ruotsalaista yliopistojärjestelmää
(ml. Tarto) muuttuu tärkeäksi).

Kuinka paljon yliopistoon liittyvää julkaisutoimintaa

Kuinka paljon julkaisijoita

Miten julkaisijoiden verkosto muodostuu Turussa

Miten eri julkaisijoita Turussa voitaisiin luokitella (julkaiseeko
joku paperinkulutukseltaan vain pieniä dokumentteja, julkaiseeko joku
painotalo huomattavasti enemmän kuin toiset).

TODO_Turku in Sweden 2: Kaaviot Fennicasta ja Kungligasta, jossa lasketaan eri kaupunkien mukaan asiasanojen määrä eri vuosina. Asiasanat ovat osin arbriträärisiä, mutta ehkä niiden määrän pohjalta voidaan sanoa jotain eri kaupunkien julkaisuprofiilien muutoksista. Laaditaan kaaviot Tukholmasta, Uppsalasta, Lundista, Greifswaldista ja Turusta vuoteen 1828. Fennican osalta tehdään myös kaavio Vaasasta, jotta nähdään kuinka Vaasan hovioikeuteen painottunut julkaiseminen erottuu Turun julkaisemisesta.

TODO_Turku in Sweden 1 (jos ehditään ja on mahdollista): Kaaviot Fennicasta ja Kungligasta, jossa lasketaan eri kaupunkien nimikemäärien, paperinkulutuksen ja kustantajien suhteellinen osuus vuoteen 1828. Eli samanlainen kaavio kuin on kielistä ”Book printing in Finland” –osiossa. Laaditaan kaaviot Tukholmasta, Uppsalasta, Lundista, Greifswaldista ja Turusta. Voiko myös tehdä erillisen kaavion, jossa Tukholma on poistettu, josta näkee näiden kilpailevien kakkoskaupunkien tilanteen.

TODO_Turku in Sweden 3: Kun kerran ollaan maps and space sessiossa, ehkä kannattaisi tehdä myös kartta jossa, nämä eri kaupungit ja niiden nimikemäärät ovat kartalla. Kartat kannattaisi kai tehdä vuosille 1650, 1710, 1767 ja 1800. Onko tämä mahdollista?


### Other points if the time allows

Vertailukohtia CERListä tai sitten ehkä ESTCstä pitää ottaa Fennicalle
että pystytään suhteuttamaan mistä puhutaan [verratkaa vaikka aiempiin
julkaisuihin, ei sotketa enempää katalogeja nyt tähän soppaan ?]

Ks myös Subject topics ainakin yliopisto-väitöskirjoihin liittyen.

tuleeko uusia kustantajia kenttään valtiopäivien myötä ? 

 * Fennica pois lukien Suomi ?
 * Kungliga pois lukien Ruotsi ?

[Topic](https://github.com/rOpenGov/kungliga/blob/master/antagomir/topic.md)
saadaanko mitään irti (1470-1830 tai 1640-1830).

Further todo points. Let us move in this manuscript only those points
that there is time to do.

 * [Fennica TODO](https://github.com/rOpenGov/fennica/blob/master/inst/examples/TODO.md)
 * [Kungliga TODO](https://github.com/rOpenGov/kungliga/blob/master/antagomir/TODO.md)







## Conclusions

Library catalogues contain rich metadata on...

Here we have analysed Fennica & Kungliga.. 

Further draft text in the funding application..?




## Materials and Methods

We obtained Fennica and Kungliga library catalogues from..

The raw data contains metadata `r nrow(fenraw)` and `r nrow(kunraw)` documents in Fennica and Kungliga, respectively. We limited the present analysis in the time interval `r min(df0$publication_year)`-`r max(df0$publication_year)`, yielding a subset of `r nrow(subset(df0, catalog == "Fennica"))` (`r round(100*nrow(subset(df0, catalog == "Fennica"))/nrow(fenraw), 1)`%) and `r nrow(subset(df0, catalog == "Kungliga"))` (`r round(100*nrow(subset(df0, catalog == "Kunliga"))/nrow(kunraw), 1)`%) documents for Fennica and Kungliga, respectively.



We have prepared open data analytical ecosystem for in-depth analysis of such data collections ([Lahti, Ilomaki, Tolonen (2015)](http://doi.org/10.18352/lq.10112)). In summary, the data analytical ecosystem does .. Reading, parsing, cleaning up, enriching, summarizing, analysis, visualization, figures and tables.. [SUMMARY FIGURE OF THE PROCESS?]. Full source code to reproduce these analyses are available via Github ([Fennica](https://github.com/rOpenGov/fennica/); [Kungliga](https://github.com/rOpenGov/kungliga/)).

A brief summary of the data processing steps:

**Author names**

**Author life years**

**Publication place**

**Publishers**

**Dissertations** 

**Duplicate removal** Combining the catalogs ..

**Enriching** to add gender, country, geocoordinates ..


The package utilizes tools from a number of other R extensions,
including dplyr `r citep(citation("dplyr"))`, ggplot2 `r citep(citation("ggplot2"))`, stats `r citep(citation("stats"))`, tidyr `r citep(citation("tidyr"))`.




### Acknowledgements

Supported by Academy of Finland (grant 293316).


## References

### References

```{r, echo=FALSE, message=FALSE}
#Embed citations from bib files with `r citep(bib[["lahti14natcomm"]])`. Or with @lahti14natcomm
#You can embed citations, for example: `r citep(bib[["lahti14natcomm"]])`
#You can embed citations, for example2: @lahti14natcomm
#Cite with DOI: `r citep("10.1890/11-0011.1")`
#Cite URL `r citep("http://knowledgeblog.org/greycite")`
#For automated markdown citations, check [this](http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html), [this](https://github.com/cboettig/knitcitations), and [this](http://www.carlboettiger.info/2012/03/24/citations-in-markdown-using-knitr.html). 
#write.bibtex(file="references.bib")
```

```{r, echo=FALSE, message=FALSE, results='asis'}
bibliography(sorting = 'ynt')
```

## Miscellaneous ideas to consider

[ESTC-analyses](https://github.com/rOpenGov/estc)
([LIBER](https://github.com/rOpenGov/estc/blob/master/inst/examples/20151023-LIBER.md)
in particular); toisto Fennica/Kungliga datoilla ? LL: lisäilin
joitain analyyseja tahan mutta jos tahdotte lisaa niin pyytakaa
erikseen.


The most active known female authors based on the title count:

```{r 201606krakow-fennica-topfemale, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, fig.height=5, fig.width=20, out.width="850px"}
theme_set(theme_bw(10))
dfs <- fen %>% filter(author_gender == "female")
p <- top_plot(dfs, "author", ntop = 20)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title count")
p <- p + ggtitle("Top female authors\n(Fennica)")
p <- p + theme(axis.text.x = element_text(size = 16), axis.text.y = element_text(size = 16), axis.title.x = element_text(size = 25), axis.title.y = element_text(size = 22), title = element_text(size = 22))
pf = p

theme_set(theme_bw(20))
dfs <- kun %>% filter(author_gender == "female")
p <- top_plot(dfs, "author", ntop = 20)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title count")
p <- p + ggtitle("Top female authors\n(Kungliga)")
p <- p + theme(axis.text.x = element_text(size = 16), axis.text.y = element_text(size = 16), axis.title.x = element_text(size = 25), axis.title.y = element_text(size = 22), title = element_text(size = 22))
pk = p

library(gridExtra)
grid.arrange(pf, pk, nrow = 1)
```





## Session info

This document was created with the following versions:

```{r sessioninfo, message=FALSE, warning=FALSE}
sessionInfo()
```





