--- 
title: "Harmonized Finnish National Bibliography"
author: "Turku Data Science Group"
date: "`r Sys.Date()`"
site: "bookdown::bookdown_site"
output:
  bookdown::gitbook: default
documentclass: book
---

# Preface chapter

Placeholder



<!--chapter:end:index.Rmd-->

# Author's lifetime

```{r source-author-date, include=FALSE}
# author_date field
source("author_date.R")
```

[Author date accepted](output.tables/auhtor_date_accepted.csv)

[Author date discarded](output.tables/auhtor_date_discarded.csv)

Author's lifetime is available for `r sum(!is.na(df$author_age))` authors (`r round(100*mean(!is.na(df$author_age)))`%).The lifetime years span `r range(na.omit((df$author_age)))`. The youngest being 17 years old and the oldest 99 years old.





<!--chapter:end:author_date.Rmd-->


# Author's name

Placeholder


## Authors
### Auxiliary files

<!--chapter:end:author_name.Rmd-->


# Corporate

Placeholder



<!--chapter:end:corporate.Rmd-->


# Language summaries

Placeholder


## Top languages

<!--chapter:end:language.Rmd-->


# Holder

Placeholder



<!--chapter:end:holder.Rmd-->


# Note 510C

Placeholder



<!--chapter:end:note_510c.Rmd-->


# Note dissertation

Placeholder



<!--chapter:end:note_dissertation.Rmd-->


# Note granter

Placeholder



<!--chapter:end:note_granter.Rmd-->


# Note source

Placeholder



<!--chapter:end:note_source.Rmd-->


# Publisher preprocessing summary

Placeholder



<!--chapter:end:publisher.Rmd-->

```{r source-publication-interval, include=FALSE, eval=knit_bookdown}
#publication_interval field
source("publication_interval.R")
```

# Publication interval summaries

Publication interval is available for `r sum(!is.na(df$publication_interval_from) | !is.na(df$publication_interval_till))` documents (`r round(100*mean(!is.na(df$publication_interval_from) | !is.na(df$publication_interval_till)))`%). 

[Publication interval accepted](output.tables/publication_interval_accepted.csv)

[Publication interval conversions](output.tables/publication_interval_conversion_nontrivial.csv)

[Publication interval discarded](output.tables/publication_interval_discarded.csv)



<!--chapter:end:publication_interval.Rmd-->

```{r source-publication-place, include=FALSE, eval=knit_bookdown}
# Publication place field and derived country- and geoinformation
source("publication_place.R")
```

# Publication place preprocessing summary

 * `r length(unique(str_trim(unlist(strsplit(as.character(df$publication_place), ";")))))` [unique publication places](output.tables/publication_place_accepted.csv); available for `r sum(!is.na(df$publication_place))` documents (`r round(100*mean(!is.na(df$publication_place)))`%).
 * `r length(readLines(paste0("output.tables/publication_place_ambiguous.csv"))) - 1` [ambiguous publication places](output.tables/publication_place_ambiguous.csv); some of these can be possibly resolved by checking that the the [synonyme list](https://github.com/COMHIS/fennica/blob/master/inst/extdata/PublicationPlaceSynonymes.csv) does not contain multiple versions of the final name (case sensitive). 
 * `r try(length(readLines(paste0("output.tables/publication_place_todo.csv"))))` [unknown place names](output.tables/publication_place_todo.csv) These terms do not map to any known place on the [synonyme list](https://github.com/COMHIS/fennica/blob/master/inst/extdata/PublicationPlaceSynonymes.csv); either because they require further cleaning or have not yet been encountered in the analyses. Terms that are clearly not place names can be added to [stopwords](inst/extdata/stopwords_for_place.csv); borderline cases that are not accepted as place names can be added as NA on the [synonyme list](https://github.com/COMHIS/fennica/blob/master/inst/extdata/PublicationPlaceSynonymes.csv).
 * `r length(readLines(paste0("output.tables/publication_place_discarded.csv"))) - 1` [discarded place names](output.tables/publication_place_discarded.csv) These terms are potential place names but with a closer check have been explicitly rejected on the [synonyme list](https://github.com/COMHIS/fennica/blob/master/inst/extdata/PublicationPlaceSynonymes.csv)
 * [Conversions from the original to the accepted place names](output.tables/publication_place_conversion_nontrivial.csv) 
 * [Unit tests for place names](https://github.com/COMHIS/fennica/blob/master/inst/extdata/tests_place.csv) are automatically checked during package build

Top-`r ntop` publication places are shown together with the number of documents.

```{r summaryplace, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=8, fig.show='hold', out.width='430px'}
p <- top_plot(df, "publication_place", ntop)
p <- p + ggtitle(paste("Top publication places"))
p <- p + scale_y_log10()
p <- p + ylab("Title count")
print(p)

p <- top_plot(df, "publication_country", ntop)
p <- p + ggtitle(paste("Top publication countries"))
p <- p + scale_y_log10()
p <- p + ylab("Title count")
print(p)
```


## Publication countries	

 * `r length(unique(df$publication_country))` [unique publication countries](output.tables/publication_country_accepted.csv); available for `r sum(!is.na(df$publication_country))` documents (`r round(100*mean(!is.na(df$publication_country)))`%).
 * `r length(na.omit(unique(subset(df, is.na(publication_country))$publication_place)))` [places with unknown publication country](output.tables/publication_place_missingcountry.csv) (`r round(100 * length(na.omit(unique(subset(df, is.na(publication_country))$publication_place))) / length(na.omit(unique(df$publication_place))), 1)`% of the unique places; can be added to [country mappings](https://github.com/COMHIS/fennica/blob/master/inst/extdata/reg2country.csv))
 * `r length(readLines(paste0("output.tables/publication_country_ambiguous.csv"))) - 1` [potentially ambiguous region-country mappings](output.tables/publication_country_ambiguous.csv) (these may occur in the data in various synonymes and the country is not always clear when multiple countries have a similar place name; the default country is listed first). NOTE: possible improvements should not be done in this output summary but instead in the [country mapping file](https://github.com/COMHIS/fennica/blob/master/inst/extdata/reg2country.csv).

```{r summaryplace3, echo=FALSE, results='asis'}
tab <- top(df, "publication_country", output = "data.frame", round = 1)
colnames(tab) <- c("Country", "Documents (n)", "Fraction (%)")
library(knitr)
kable(head(tab))
```


## Geocoordinates

 * `r round(100*mean(!is.na(df$latitude) & !is.na(df$longitude)), 1)`% of the documents were matched to geographic coordinates (based on COMHIS geomapping process).
 * `r length(unique(df$publication_place[(is.na(df$latitude))]))` unique places (`r round(100 * length(unique(df$publication_place[(is.na(df$latitude))]))/length(unique(df$publication_place)), 1)`% of all unique places and `r round(100 * mean(is.na(df$latitude) | is.na(df$longitude)), 2)`% of all documents) are missing geocoordinates. See [list of places missing geocoordinate information](output.tables/absentgeocoordinates.csv).
 


<!--chapter:end:publication_place.Rmd-->

```{r source-publication-time, include=FALSE, eval=knit_bookdown}
# Publication place field and derived country- and geoinformation
source("publication_time.R")
```

# Publication year summaries (publication time)

[Publication year conversions](output.tables/publication_year_conversion.csv)

[Publication year discarded](output.tables/publication_year_discarded.csv)

Publication year is available for `r sum(!is.na(df$publication_year))` documents (`r round(100*mean(!is.na(df$publication_year)))`%). The publication years span `r paste(range(na.omit(df$publication_year)), collapse = "-")`.

```{r summarypublicationyear, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
# Title count per decade
df2 <- df %>% group_by(publication_decade) %>% filter(publication_decade < 2010) 
p <- ggplot(df2, aes(publication_decade)) +
     geom_bar() + scale_y_log10() +
     ggtitle("Title count timeline")
print(p)
```



<!--chapter:end:publication_time.Rmd-->


# Subject topic

Placeholder



<!--chapter:end:subject_topic.Rmd-->

```{r source-subject-geography, include=FALSE, eval=knit_bookdown}
# note_subject_topic field
source("subject_geography.R")
```

# Subject geography preprocessing summary (Subject geographical places)

```{r geo, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10}
tab <- rev(sort(table(unlist(strsplit(as.character(df$subject_geography), ";")))))
```

Top-`r ntop` geographical places are shown together with the number of documents assigned to that region. Geography information is available for `r sum(!is.na(df$subject_geography))` documents (`r round(100*mean(!is.na(df$subject_geography)))`%). There are `r length(tab)` unique geographical places.

```{r geo2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=10, eval=FALSE}
ntop <- 50
par(mar = c(5, 10, 3, 1)); barplot(log10(rev(tab[1:ntop])), horiz = T, las = 1, cex.names = 0.8, xlab = "Documents (log10)", main = "Most common geographic places")
```

```{r geo3, echo=FALSE, message=FALSE, warning=FALSE}
f <- "output.tables/geoplaces.csv"
write.table(cbind(Geography = names(tab), Documents = tab), file = f, sep = "|", quote = F, row.names = F)
```

[Complete geoplace listing](https://github.com/COMHIS/fennica/blob/master/inst/examples/output.tables/geoplaces.csv)



<!--chapter:end:subject_geography.Rmd-->


# Successor

Placeholder



<!--chapter:end:successor.Rmd-->


# Title field: summary

Placeholder



<!--chapter:end:title.Rmd-->


# Title uniform

Placeholder



<!--chapter:end:title_uniform.Rmd-->


# Uncontrolled

Placeholder



<!--chapter:end:uncontrolled.Rmd-->

